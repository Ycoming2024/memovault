"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/y-websocket";
exports.ids = ["vendor-chunks/y-websocket"];
exports.modules = {

/***/ "(ssr)/./node_modules/y-websocket/src/y-websocket.js":
/*!*****************************************************!*\
  !*** ./node_modules/y-websocket/src/y-websocket.js ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebsocketProvider: () => (/* binding */ WebsocketProvider),\n/* harmony export */   messageAuth: () => (/* binding */ messageAuth),\n/* harmony export */   messageAwareness: () => (/* binding */ messageAwareness),\n/* harmony export */   messageQueryAwareness: () => (/* binding */ messageQueryAwareness),\n/* harmony export */   messageSync: () => (/* binding */ messageSync)\n/* harmony export */ });\n/* harmony import */ var lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! lib0/broadcastchannel */ \"(ssr)/./node_modules/lib0/broadcastchannel.js\");\n/* harmony import */ var lib0_time__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lib0/time */ \"(ssr)/./node_modules/lib0/time.js\");\n/* harmony import */ var lib0_encoding__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lib0/encoding */ \"(ssr)/./node_modules/lib0/encoding.js\");\n/* harmony import */ var lib0_decoding__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lib0/decoding */ \"(ssr)/./node_modules/lib0/decoding.js\");\n/* harmony import */ var y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! y-protocols/sync */ \"(ssr)/./node_modules/y-protocols/sync.js\");\n/* harmony import */ var y_protocols_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! y-protocols/auth */ \"(ssr)/./node_modules/y-protocols/auth.js\");\n/* harmony import */ var y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! y-protocols/awareness */ \"(ssr)/./node_modules/y-protocols/awareness.js\");\n/* harmony import */ var lib0_observable__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! lib0/observable */ \"(ssr)/./node_modules/lib0/observable.js\");\n/* harmony import */ var lib0_math__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lib0/math */ \"(ssr)/./node_modules/lib0/math.js\");\n/* harmony import */ var lib0_url__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! lib0/url */ \"(ssr)/./node_modules/lib0/url.js\");\n/* harmony import */ var lib0_environment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! lib0/environment */ \"(ssr)/./node_modules/lib0/environment.js\");\n/**\n * @module provider/websocket\n */\n\n/* eslint-env browser */\n\n // eslint-disable-line\n\n\n\n\n\n\n\n\n\n\n\n\nconst messageSync = 0\nconst messageQueryAwareness = 3\nconst messageAwareness = 1\nconst messageAuth = 2\n\n/**\n *                       encoder,          decoder,          provider,          emitSynced, messageType\n * @type {Array<function(encoding.Encoder, decoding.Decoder, WebsocketProvider, boolean,    number):void>}\n */\nconst messageHandlers = []\n\nmessageHandlers[messageSync] = (\n  encoder,\n  decoder,\n  provider,\n  emitSynced,\n  _messageType\n) => {\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n  const syncMessageType = y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.readSyncMessage(\n    decoder,\n    encoder,\n    provider.doc,\n    provider\n  )\n  if (\n    emitSynced && syncMessageType === y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.messageYjsSyncStep2 &&\n    !provider.synced\n  ) {\n    provider.synced = true\n  }\n}\n\nmessageHandlers[messageQueryAwareness] = (\n  encoder,\n  _decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n    encoder,\n    y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(\n      provider.awareness,\n      Array.from(provider.awareness.getStates().keys())\n    )\n  )\n}\n\nmessageHandlers[messageAwareness] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.applyAwarenessUpdate(\n    provider.awareness,\n    lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.readVarUint8Array(decoder),\n    provider\n  )\n}\n\nmessageHandlers[messageAuth] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  y_protocols_auth__WEBPACK_IMPORTED_MODULE_1__.readAuthMessage(\n    decoder,\n    provider.doc,\n    (_ydoc, reason) => permissionDeniedHandler(provider, reason)\n  )\n}\n\n// @todo - this should depend on awareness.outdatedTime\nconst messageReconnectTimeout = 30000\n\n/**\n * @param {WebsocketProvider} provider\n * @param {string} reason\n */\nconst permissionDeniedHandler = (provider, reason) =>\n  console.warn(`Permission denied to access ${provider.url}.\\n${reason}`)\n\n/**\n * @param {WebsocketProvider} provider\n * @param {Uint8Array} buf\n * @param {boolean} emitSynced\n * @return {encoding.Encoder}\n */\nconst readMessage = (provider, buf, emitSynced) => {\n  const decoder = lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.createDecoder(buf)\n  const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n  const messageType = lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.readVarUint(decoder)\n  const messageHandler = provider.messageHandlers[messageType]\n  if (/** @type {any} */ (messageHandler)) {\n    messageHandler(encoder, decoder, provider, emitSynced, messageType)\n  } else {\n    console.error('Unable to compute message')\n  }\n  return encoder\n}\n\n/**\n * Outsource this function so that a new websocket connection is created immediately.\n * I suspect that the `ws.onclose` event is not always fired if there are network issues.\n *\n * @param {WebsocketProvider} provider\n * @param {WebSocket} ws\n * @param {CloseEvent | null} event\n */\nconst closeWebsocketConnection = (provider, ws, event) => {\n  if (ws === provider.ws) {\n    provider.emit('connection-close', [event, provider])\n    provider.ws = null\n    ws.close()\n    provider.wsconnecting = false\n    if (provider.wsconnected) {\n      provider.wsconnected = false\n      provider.synced = false\n      // update awareness (all users except local left)\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.removeAwarenessStates(\n        provider.awareness,\n        Array.from(provider.awareness.getStates().keys()).filter((client) =>\n          client !== provider.doc.clientID\n        ),\n        provider\n      )\n      provider.emit('status', [{\n        status: 'disconnected'\n      }])\n    } else {\n      provider.wsUnsuccessfulReconnects++\n    }\n    // Start with no reconnect timeout and increase timeout by\n    // using exponential backoff starting with 100ms\n    setTimeout(\n      setupWS,\n      lib0_math__WEBPACK_IMPORTED_MODULE_5__.min(\n        lib0_math__WEBPACK_IMPORTED_MODULE_5__.pow(2, provider.wsUnsuccessfulReconnects) * 100,\n        provider.maxBackoffTime\n      ),\n      provider\n    )\n  }\n}\n\n/**\n * @param {WebsocketProvider} provider\n */\nconst setupWS = (provider) => {\n  if (provider.shouldConnect && provider.ws === null) {\n    const websocket = new provider._WS(provider.url, provider.protocols)\n    websocket.binaryType = 'arraybuffer'\n    provider.ws = websocket\n    provider.wsconnecting = true\n    provider.wsconnected = false\n    provider.synced = false\n\n    websocket.onmessage = (event) => {\n      provider.wsLastMessageReceived = lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime()\n      const encoder = readMessage(provider, new Uint8Array(event.data), true)\n      if (lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.length(encoder) > 1) {\n        websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      }\n    }\n    websocket.onerror = (event) => {\n      provider.emit('connection-error', [event, provider])\n    }\n    websocket.onclose = (event) => {\n      closeWebsocketConnection(provider, websocket, event)\n    }\n    websocket.onopen = () => {\n      provider.wsLastMessageReceived = lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime()\n      provider.wsconnecting = false\n      provider.wsconnected = true\n      provider.wsUnsuccessfulReconnects = 0\n      provider.emit('status', [{\n        status: 'connected'\n      }])\n      // always send sync step 1 when connected\n      const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n      y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoder, provider.doc)\n      websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      // broadcast local awareness state\n      if (provider.awareness.getLocalState() !== null) {\n        const encoderAwarenessState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessState, messageAwareness)\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n          encoderAwarenessState,\n          y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(provider.awareness, [\n            provider.doc.clientID\n          ])\n        )\n        websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessState))\n      }\n    }\n    provider.emit('status', [{\n      status: 'connecting'\n    }])\n  }\n}\n\n/**\n * @param {WebsocketProvider} provider\n * @param {ArrayBuffer} buf\n */\nconst broadcastMessage = (provider, buf) => {\n  const ws = provider.ws\n  if (provider.wsconnected && ws && ws.readyState === ws.OPEN) {\n    ws.send(buf)\n  }\n  if (provider.bcconnected) {\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(provider.bcChannel, buf, provider)\n  }\n}\n\n/**\n * Websocket Provider for Yjs. Creates a websocket connection to sync the shared document.\n * The document name is attached to the provided url. I.e. the following example\n * creates a websocket connection to http://localhost:1234/my-document-name\n *\n * @example\n *   import * as Y from 'yjs'\n *   import { WebsocketProvider } from 'y-websocket'\n *   const doc = new Y.Doc()\n *   const provider = new WebsocketProvider('http://localhost:1234', 'my-document-name', doc)\n *\n * @extends {ObservableV2<{ 'connection-close': (event: CloseEvent | null,  provider: WebsocketProvider) => any, 'status': (event: { status: 'connected' | 'disconnected' | 'connecting' }) => any, 'connection-error': (event: Event, provider: WebsocketProvider) => any, 'sync': (state: boolean) => any }>}\n */\nclass WebsocketProvider extends lib0_observable__WEBPACK_IMPORTED_MODULE_8__.ObservableV2 {\n  /**\n   * @param {string} serverUrl\n   * @param {string} roomname\n   * @param {Y.Doc} doc\n   * @param {object} opts\n   * @param {boolean} [opts.connect]\n   * @param {awarenessProtocol.Awareness} [opts.awareness]\n   * @param {Object<string,string>} [opts.params] specify url parameters\n   * @param {Array<string>} [opts.protocols] specify websocket protocols\n   * @param {typeof WebSocket} [opts.WebSocketPolyfill] Optionall provide a WebSocket polyfill\n   * @param {number} [opts.resyncInterval] Request server state every `resyncInterval` milliseconds\n   * @param {number} [opts.maxBackoffTime] Maximum amount of time to wait before trying to reconnect (we try to reconnect using exponential backoff)\n   * @param {boolean} [opts.disableBc] Disable cross-tab BroadcastChannel communication\n   */\n  constructor (serverUrl, roomname, doc, {\n    connect = true,\n    awareness = new y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.Awareness(doc),\n    params = {},\n    protocols = [],\n    WebSocketPolyfill = WebSocket,\n    resyncInterval = -1,\n    maxBackoffTime = 2500,\n    disableBc = false\n  } = {}) {\n    super()\n    // ensure that url is always ends with /\n    while (serverUrl[serverUrl.length - 1] === '/') {\n      serverUrl = serverUrl.slice(0, serverUrl.length - 1)\n    }\n    this.serverUrl = serverUrl\n    this.bcChannel = serverUrl + '/' + roomname\n    this.maxBackoffTime = maxBackoffTime\n    /**\n     * The specified url parameters. This can be safely updated. The changed parameters will be used\n     * when a new connection is established.\n     * @type {Object<string,string>}\n     */\n    this.params = params\n    this.protocols = protocols\n    this.roomname = roomname\n    this.doc = doc\n    this._WS = WebSocketPolyfill\n    this.awareness = awareness\n    this.wsconnected = false\n    this.wsconnecting = false\n    this.bcconnected = false\n    this.disableBc = disableBc\n    this.wsUnsuccessfulReconnects = 0\n    this.messageHandlers = messageHandlers.slice()\n    /**\n     * @type {boolean}\n     */\n    this._synced = false\n    /**\n     * @type {WebSocket?}\n     */\n    this.ws = null\n    this.wsLastMessageReceived = 0\n    /**\n     * Whether to connect to other peers or not\n     * @type {boolean}\n     */\n    this.shouldConnect = connect\n\n    /**\n     * @type {number}\n     */\n    this._resyncInterval = 0\n    if (resyncInterval > 0) {\n      this._resyncInterval = /** @type {any} */ (setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          // resend sync step 1\n          const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n          lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n          y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoder, doc)\n          this.ws.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n        }\n      }, resyncInterval))\n    }\n\n    /**\n     * @param {ArrayBuffer} data\n     * @param {any} origin\n     */\n    this._bcSubscriber = (data, origin) => {\n      if (origin !== this) {\n        const encoder = readMessage(this, new Uint8Array(data), false)\n        if (lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.length(encoder) > 1) {\n          lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder), this)\n        }\n      }\n    }\n    /**\n     * Listens to Yjs updates and sends them to remote peers (ws and broadcastchannel)\n     * @param {Uint8Array} update\n     * @param {any} origin\n     */\n    this._updateHandler = (update, origin) => {\n      if (origin !== this) {\n        const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n        y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeUpdate(encoder, update)\n        broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      }\n    }\n    this.doc.on('update', this._updateHandler)\n    /**\n     * @param {any} changed\n     * @param {any} _origin\n     */\n    this._awarenessUpdateHandler = ({ added, updated, removed }, _origin) => {\n      const changedClients = added.concat(updated).concat(removed)\n      const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n        encoder,\n        y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(awareness, changedClients)\n      )\n      broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n    }\n    this._exitHandler = () => {\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.removeAwarenessStates(\n        this.awareness,\n        [doc.clientID],\n        'app closed'\n      )\n    }\n    if (lib0_environment__WEBPACK_IMPORTED_MODULE_9__.isNode && typeof process !== 'undefined') {\n      process.on('exit', this._exitHandler)\n    }\n    awareness.on('update', this._awarenessUpdateHandler)\n    this._checkInterval = /** @type {any} */ (setInterval(() => {\n      if (\n        this.wsconnected &&\n        messageReconnectTimeout <\n          lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime() - this.wsLastMessageReceived\n      ) {\n        // no message received in a long time - not even your own awareness\n        // updates (which are updated every 15 seconds)\n        closeWebsocketConnection(this, /** @type {WebSocket} */ (this.ws), null)\n      }\n    }, messageReconnectTimeout / 10))\n    if (connect) {\n      this.connect()\n    }\n  }\n\n  get url () {\n    const encodedParams = lib0_url__WEBPACK_IMPORTED_MODULE_10__.encodeQueryParams(this.params)\n    return this.serverUrl + '/' + this.roomname +\n      (encodedParams.length === 0 ? '' : '?' + encodedParams)\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get synced () {\n    return this._synced\n  }\n\n  set synced (state) {\n    if (this._synced !== state) {\n      this._synced = state\n      // @ts-ignore\n      this.emit('synced', [state])\n      this.emit('sync', [state])\n    }\n  }\n\n  destroy () {\n    if (this._resyncInterval !== 0) {\n      clearInterval(this._resyncInterval)\n    }\n    clearInterval(this._checkInterval)\n    this.disconnect()\n    if (lib0_environment__WEBPACK_IMPORTED_MODULE_9__.isNode && typeof process !== 'undefined') {\n      process.off('exit', this._exitHandler)\n    }\n    this.awareness.off('update', this._awarenessUpdateHandler)\n    this.doc.off('update', this._updateHandler)\n    super.destroy()\n  }\n\n  connectBc () {\n    if (this.disableBc) {\n      return\n    }\n    if (!this.bcconnected) {\n      lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.subscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = true\n    }\n    // send sync step1 to bc\n    // write sync step 1\n    const encoderSync = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderSync, messageSync)\n    y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoderSync, this.doc)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderSync), this)\n    // broadcast local state\n    const encoderState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderState, messageSync)\n    y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep2(encoderState, this.doc)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderState), this)\n    // write queryAwareness\n    const encoderAwarenessQuery = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessQuery, messageQueryAwareness)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(\n      this.bcChannel,\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessQuery),\n      this\n    )\n    // broadcast local awareness state\n    const encoderAwarenessState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessState, messageAwareness)\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n      encoderAwarenessState,\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ])\n    )\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(\n      this.bcChannel,\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessState),\n      this\n    )\n  }\n\n  disconnectBc () {\n    // broadcast message with local awareness state set to null (indicating disconnect)\n    const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n      encoder,\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ], new Map())\n    )\n    broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n    if (this.bcconnected) {\n      lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.unsubscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = false\n    }\n  }\n\n  disconnect () {\n    this.shouldConnect = false\n    this.disconnectBc()\n    if (this.ws !== null) {\n      closeWebsocketConnection(this, this.ws, null)\n    }\n  }\n\n  connect () {\n    this.shouldConnect = true\n    if (!this.wsconnected && this.ws === null) {\n      setupWS(this)\n      this.connectBc()\n    }\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMveS13ZWJzb2NrZXQvc3JjL3ktd2Vic29ja2V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRXdCO0FBQ21CO0FBQ1Y7QUFDUTtBQUNBO0FBQ087QUFDQTtBQUNVO0FBQ1o7QUFDYjtBQUNGO0FBQ1E7O0FBRWhDO0FBQ0E7QUFDQTtBQUNBOztBQUVQO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsdURBQXFCO0FBQ3ZCLDBCQUEwQiw2REFBNEI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGlFQUFnQztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1REFBcUI7QUFDdkIsRUFBRSw2REFBMkI7QUFDN0I7QUFDQSxJQUFJLHdFQUF1QztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1RUFBc0M7QUFDeEM7QUFDQSxJQUFJLDREQUEwQjtBQUM5QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLDZEQUE0QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXLG1CQUFtQjtBQUM5QixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBLDhDQUE4QyxhQUFhLEtBQUssT0FBTzs7QUFFdkU7QUFDQSxXQUFXLG1CQUFtQjtBQUM5QixXQUFXLFlBQVk7QUFDdkIsV0FBVyxTQUFTO0FBQ3BCLFlBQVk7QUFDWjtBQUNBO0FBQ0Esa0JBQWtCLHdEQUFzQjtBQUN4QyxrQkFBa0Isd0RBQXNCO0FBQ3hDLHNCQUFzQixz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QUFJLDBEQUFVLGlCQUFpQix1REFBcUI7QUFDcEQ7QUFDQSx5QkFBeUIsd0RBQXNCO0FBQy9DLElBQUksdURBQXFCO0FBQ3pCLElBQUksNERBQTJCO0FBQy9CLElBQUksMERBQVUsaUJBQWlCLHVEQUFxQjtBQUNwRDtBQUNBLGtDQUFrQyx3REFBc0I7QUFDeEQsSUFBSSx1REFBcUI7QUFDekIsSUFBSSwwREFBVTtBQUNkO0FBQ0EsTUFBTSx1REFBcUI7QUFDM0I7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLHdEQUFzQjtBQUN4RCxJQUFJLHVEQUFxQjtBQUN6QixJQUFJLDZEQUEyQjtBQUMvQjtBQUNBLE1BQU0sd0VBQXVDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLElBQUksMERBQVU7QUFDZDtBQUNBLE1BQU0sdURBQXFCO0FBQzNCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLHdEQUFzQjtBQUMxQyxJQUFJLHVEQUFxQjtBQUN6QixJQUFJLDZEQUEyQjtBQUMvQjtBQUNBLE1BQU0sd0VBQXVDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1REFBcUI7QUFDaEQ7QUFDQSxNQUFNLDhEQUFjO0FBQ3BCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVtb3ZhdWx0Ly4vbm9kZV9tb2R1bGVzL3ktd2Vic29ja2V0L3NyYy95LXdlYnNvY2tldC5qcz81OGRjIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQG1vZHVsZSBwcm92aWRlci93ZWJzb2NrZXRcbiAqL1xuXG4vKiBlc2xpbnQtZW52IGJyb3dzZXIgKi9cblxuaW1wb3J0ICogYXMgWSBmcm9tICd5anMnIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbmltcG9ydCAqIGFzIGJjIGZyb20gJ2xpYjAvYnJvYWRjYXN0Y2hhbm5lbCdcbmltcG9ydCAqIGFzIHRpbWUgZnJvbSAnbGliMC90aW1lJ1xuaW1wb3J0ICogYXMgZW5jb2RpbmcgZnJvbSAnbGliMC9lbmNvZGluZydcbmltcG9ydCAqIGFzIGRlY29kaW5nIGZyb20gJ2xpYjAvZGVjb2RpbmcnXG5pbXBvcnQgKiBhcyBzeW5jUHJvdG9jb2wgZnJvbSAneS1wcm90b2NvbHMvc3luYydcbmltcG9ydCAqIGFzIGF1dGhQcm90b2NvbCBmcm9tICd5LXByb3RvY29scy9hdXRoJ1xuaW1wb3J0ICogYXMgYXdhcmVuZXNzUHJvdG9jb2wgZnJvbSAneS1wcm90b2NvbHMvYXdhcmVuZXNzJ1xuaW1wb3J0IHsgT2JzZXJ2YWJsZVYyIH0gZnJvbSAnbGliMC9vYnNlcnZhYmxlJ1xuaW1wb3J0ICogYXMgbWF0aCBmcm9tICdsaWIwL21hdGgnXG5pbXBvcnQgKiBhcyB1cmwgZnJvbSAnbGliMC91cmwnXG5pbXBvcnQgKiBhcyBlbnYgZnJvbSAnbGliMC9lbnZpcm9ubWVudCdcblxuZXhwb3J0IGNvbnN0IG1lc3NhZ2VTeW5jID0gMFxuZXhwb3J0IGNvbnN0IG1lc3NhZ2VRdWVyeUF3YXJlbmVzcyA9IDNcbmV4cG9ydCBjb25zdCBtZXNzYWdlQXdhcmVuZXNzID0gMVxuZXhwb3J0IGNvbnN0IG1lc3NhZ2VBdXRoID0gMlxuXG4vKipcbiAqICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVyLCAgICAgICAgICBkZWNvZGVyLCAgICAgICAgICBwcm92aWRlciwgICAgICAgICAgZW1pdFN5bmNlZCwgbWVzc2FnZVR5cGVcbiAqIEB0eXBlIHtBcnJheTxmdW5jdGlvbihlbmNvZGluZy5FbmNvZGVyLCBkZWNvZGluZy5EZWNvZGVyLCBXZWJzb2NrZXRQcm92aWRlciwgYm9vbGVhbiwgICAgbnVtYmVyKTp2b2lkPn1cbiAqL1xuY29uc3QgbWVzc2FnZUhhbmRsZXJzID0gW11cblxubWVzc2FnZUhhbmRsZXJzW21lc3NhZ2VTeW5jXSA9IChcbiAgZW5jb2RlcixcbiAgZGVjb2RlcixcbiAgcHJvdmlkZXIsXG4gIGVtaXRTeW5jZWQsXG4gIF9tZXNzYWdlVHlwZVxuKSA9PiB7XG4gIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlU3luYylcbiAgY29uc3Qgc3luY01lc3NhZ2VUeXBlID0gc3luY1Byb3RvY29sLnJlYWRTeW5jTWVzc2FnZShcbiAgICBkZWNvZGVyLFxuICAgIGVuY29kZXIsXG4gICAgcHJvdmlkZXIuZG9jLFxuICAgIHByb3ZpZGVyXG4gIClcbiAgaWYgKFxuICAgIGVtaXRTeW5jZWQgJiYgc3luY01lc3NhZ2VUeXBlID09PSBzeW5jUHJvdG9jb2wubWVzc2FnZVlqc1N5bmNTdGVwMiAmJlxuICAgICFwcm92aWRlci5zeW5jZWRcbiAgKSB7XG4gICAgcHJvdmlkZXIuc3luY2VkID0gdHJ1ZVxuICB9XG59XG5cbm1lc3NhZ2VIYW5kbGVyc1ttZXNzYWdlUXVlcnlBd2FyZW5lc3NdID0gKFxuICBlbmNvZGVyLFxuICBfZGVjb2RlcixcbiAgcHJvdmlkZXIsXG4gIF9lbWl0U3luY2VkLFxuICBfbWVzc2FnZVR5cGVcbikgPT4ge1xuICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlciwgbWVzc2FnZUF3YXJlbmVzcylcbiAgZW5jb2Rpbmcud3JpdGVWYXJVaW50OEFycmF5KFxuICAgIGVuY29kZXIsXG4gICAgYXdhcmVuZXNzUHJvdG9jb2wuZW5jb2RlQXdhcmVuZXNzVXBkYXRlKFxuICAgICAgcHJvdmlkZXIuYXdhcmVuZXNzLFxuICAgICAgQXJyYXkuZnJvbShwcm92aWRlci5hd2FyZW5lc3MuZ2V0U3RhdGVzKCkua2V5cygpKVxuICAgIClcbiAgKVxufVxuXG5tZXNzYWdlSGFuZGxlcnNbbWVzc2FnZUF3YXJlbmVzc10gPSAoXG4gIF9lbmNvZGVyLFxuICBkZWNvZGVyLFxuICBwcm92aWRlcixcbiAgX2VtaXRTeW5jZWQsXG4gIF9tZXNzYWdlVHlwZVxuKSA9PiB7XG4gIGF3YXJlbmVzc1Byb3RvY29sLmFwcGx5QXdhcmVuZXNzVXBkYXRlKFxuICAgIHByb3ZpZGVyLmF3YXJlbmVzcyxcbiAgICBkZWNvZGluZy5yZWFkVmFyVWludDhBcnJheShkZWNvZGVyKSxcbiAgICBwcm92aWRlclxuICApXG59XG5cbm1lc3NhZ2VIYW5kbGVyc1ttZXNzYWdlQXV0aF0gPSAoXG4gIF9lbmNvZGVyLFxuICBkZWNvZGVyLFxuICBwcm92aWRlcixcbiAgX2VtaXRTeW5jZWQsXG4gIF9tZXNzYWdlVHlwZVxuKSA9PiB7XG4gIGF1dGhQcm90b2NvbC5yZWFkQXV0aE1lc3NhZ2UoXG4gICAgZGVjb2RlcixcbiAgICBwcm92aWRlci5kb2MsXG4gICAgKF95ZG9jLCByZWFzb24pID0+IHBlcm1pc3Npb25EZW5pZWRIYW5kbGVyKHByb3ZpZGVyLCByZWFzb24pXG4gIClcbn1cblxuLy8gQHRvZG8gLSB0aGlzIHNob3VsZCBkZXBlbmQgb24gYXdhcmVuZXNzLm91dGRhdGVkVGltZVxuY29uc3QgbWVzc2FnZVJlY29ubmVjdFRpbWVvdXQgPSAzMDAwMFxuXG4vKipcbiAqIEBwYXJhbSB7V2Vic29ja2V0UHJvdmlkZXJ9IHByb3ZpZGVyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVhc29uXG4gKi9cbmNvbnN0IHBlcm1pc3Npb25EZW5pZWRIYW5kbGVyID0gKHByb3ZpZGVyLCByZWFzb24pID0+XG4gIGNvbnNvbGUud2FybihgUGVybWlzc2lvbiBkZW5pZWQgdG8gYWNjZXNzICR7cHJvdmlkZXIudXJsfS5cXG4ke3JlYXNvbn1gKVxuXG4vKipcbiAqIEBwYXJhbSB7V2Vic29ja2V0UHJvdmlkZXJ9IHByb3ZpZGVyXG4gKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IGJ1ZlxuICogQHBhcmFtIHtib29sZWFufSBlbWl0U3luY2VkXG4gKiBAcmV0dXJuIHtlbmNvZGluZy5FbmNvZGVyfVxuICovXG5jb25zdCByZWFkTWVzc2FnZSA9IChwcm92aWRlciwgYnVmLCBlbWl0U3luY2VkKSA9PiB7XG4gIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZy5jcmVhdGVEZWNvZGVyKGJ1ZilcbiAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICBjb25zdCBtZXNzYWdlVHlwZSA9IGRlY29kaW5nLnJlYWRWYXJVaW50KGRlY29kZXIpXG4gIGNvbnN0IG1lc3NhZ2VIYW5kbGVyID0gcHJvdmlkZXIubWVzc2FnZUhhbmRsZXJzW21lc3NhZ2VUeXBlXVxuICBpZiAoLyoqIEB0eXBlIHthbnl9ICovIChtZXNzYWdlSGFuZGxlcikpIHtcbiAgICBtZXNzYWdlSGFuZGxlcihlbmNvZGVyLCBkZWNvZGVyLCBwcm92aWRlciwgZW1pdFN5bmNlZCwgbWVzc2FnZVR5cGUpXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcignVW5hYmxlIHRvIGNvbXB1dGUgbWVzc2FnZScpXG4gIH1cbiAgcmV0dXJuIGVuY29kZXJcbn1cblxuLyoqXG4gKiBPdXRzb3VyY2UgdGhpcyBmdW5jdGlvbiBzbyB0aGF0IGEgbmV3IHdlYnNvY2tldCBjb25uZWN0aW9uIGlzIGNyZWF0ZWQgaW1tZWRpYXRlbHkuXG4gKiBJIHN1c3BlY3QgdGhhdCB0aGUgYHdzLm9uY2xvc2VgIGV2ZW50IGlzIG5vdCBhbHdheXMgZmlyZWQgaWYgdGhlcmUgYXJlIG5ldHdvcmsgaXNzdWVzLlxuICpcbiAqIEBwYXJhbSB7V2Vic29ja2V0UHJvdmlkZXJ9IHByb3ZpZGVyXG4gKiBAcGFyYW0ge1dlYlNvY2tldH0gd3NcbiAqIEBwYXJhbSB7Q2xvc2VFdmVudCB8IG51bGx9IGV2ZW50XG4gKi9cbmNvbnN0IGNsb3NlV2Vic29ja2V0Q29ubmVjdGlvbiA9IChwcm92aWRlciwgd3MsIGV2ZW50KSA9PiB7XG4gIGlmICh3cyA9PT0gcHJvdmlkZXIud3MpIHtcbiAgICBwcm92aWRlci5lbWl0KCdjb25uZWN0aW9uLWNsb3NlJywgW2V2ZW50LCBwcm92aWRlcl0pXG4gICAgcHJvdmlkZXIud3MgPSBudWxsXG4gICAgd3MuY2xvc2UoKVxuICAgIHByb3ZpZGVyLndzY29ubmVjdGluZyA9IGZhbHNlXG4gICAgaWYgKHByb3ZpZGVyLndzY29ubmVjdGVkKSB7XG4gICAgICBwcm92aWRlci53c2Nvbm5lY3RlZCA9IGZhbHNlXG4gICAgICBwcm92aWRlci5zeW5jZWQgPSBmYWxzZVxuICAgICAgLy8gdXBkYXRlIGF3YXJlbmVzcyAoYWxsIHVzZXJzIGV4Y2VwdCBsb2NhbCBsZWZ0KVxuICAgICAgYXdhcmVuZXNzUHJvdG9jb2wucmVtb3ZlQXdhcmVuZXNzU3RhdGVzKFxuICAgICAgICBwcm92aWRlci5hd2FyZW5lc3MsXG4gICAgICAgIEFycmF5LmZyb20ocHJvdmlkZXIuYXdhcmVuZXNzLmdldFN0YXRlcygpLmtleXMoKSkuZmlsdGVyKChjbGllbnQpID0+XG4gICAgICAgICAgY2xpZW50ICE9PSBwcm92aWRlci5kb2MuY2xpZW50SURcbiAgICAgICAgKSxcbiAgICAgICAgcHJvdmlkZXJcbiAgICAgIClcbiAgICAgIHByb3ZpZGVyLmVtaXQoJ3N0YXR1cycsIFt7XG4gICAgICAgIHN0YXR1czogJ2Rpc2Nvbm5lY3RlZCdcbiAgICAgIH1dKVxuICAgIH0gZWxzZSB7XG4gICAgICBwcm92aWRlci53c1Vuc3VjY2Vzc2Z1bFJlY29ubmVjdHMrK1xuICAgIH1cbiAgICAvLyBTdGFydCB3aXRoIG5vIHJlY29ubmVjdCB0aW1lb3V0IGFuZCBpbmNyZWFzZSB0aW1lb3V0IGJ5XG4gICAgLy8gdXNpbmcgZXhwb25lbnRpYWwgYmFja29mZiBzdGFydGluZyB3aXRoIDEwMG1zXG4gICAgc2V0VGltZW91dChcbiAgICAgIHNldHVwV1MsXG4gICAgICBtYXRoLm1pbihcbiAgICAgICAgbWF0aC5wb3coMiwgcHJvdmlkZXIud3NVbnN1Y2Nlc3NmdWxSZWNvbm5lY3RzKSAqIDEwMCxcbiAgICAgICAgcHJvdmlkZXIubWF4QmFja29mZlRpbWVcbiAgICAgICksXG4gICAgICBwcm92aWRlclxuICAgIClcbiAgfVxufVxuXG4vKipcbiAqIEBwYXJhbSB7V2Vic29ja2V0UHJvdmlkZXJ9IHByb3ZpZGVyXG4gKi9cbmNvbnN0IHNldHVwV1MgPSAocHJvdmlkZXIpID0+IHtcbiAgaWYgKHByb3ZpZGVyLnNob3VsZENvbm5lY3QgJiYgcHJvdmlkZXIud3MgPT09IG51bGwpIHtcbiAgICBjb25zdCB3ZWJzb2NrZXQgPSBuZXcgcHJvdmlkZXIuX1dTKHByb3ZpZGVyLnVybCwgcHJvdmlkZXIucHJvdG9jb2xzKVxuICAgIHdlYnNvY2tldC5iaW5hcnlUeXBlID0gJ2FycmF5YnVmZmVyJ1xuICAgIHByb3ZpZGVyLndzID0gd2Vic29ja2V0XG4gICAgcHJvdmlkZXIud3Njb25uZWN0aW5nID0gdHJ1ZVxuICAgIHByb3ZpZGVyLndzY29ubmVjdGVkID0gZmFsc2VcbiAgICBwcm92aWRlci5zeW5jZWQgPSBmYWxzZVxuXG4gICAgd2Vic29ja2V0Lm9ubWVzc2FnZSA9IChldmVudCkgPT4ge1xuICAgICAgcHJvdmlkZXIud3NMYXN0TWVzc2FnZVJlY2VpdmVkID0gdGltZS5nZXRVbml4VGltZSgpXG4gICAgICBjb25zdCBlbmNvZGVyID0gcmVhZE1lc3NhZ2UocHJvdmlkZXIsIG5ldyBVaW50OEFycmF5KGV2ZW50LmRhdGEpLCB0cnVlKVxuICAgICAgaWYgKGVuY29kaW5nLmxlbmd0aChlbmNvZGVyKSA+IDEpIHtcbiAgICAgICAgd2Vic29ja2V0LnNlbmQoZW5jb2RpbmcudG9VaW50OEFycmF5KGVuY29kZXIpKVxuICAgICAgfVxuICAgIH1cbiAgICB3ZWJzb2NrZXQub25lcnJvciA9IChldmVudCkgPT4ge1xuICAgICAgcHJvdmlkZXIuZW1pdCgnY29ubmVjdGlvbi1lcnJvcicsIFtldmVudCwgcHJvdmlkZXJdKVxuICAgIH1cbiAgICB3ZWJzb2NrZXQub25jbG9zZSA9IChldmVudCkgPT4ge1xuICAgICAgY2xvc2VXZWJzb2NrZXRDb25uZWN0aW9uKHByb3ZpZGVyLCB3ZWJzb2NrZXQsIGV2ZW50KVxuICAgIH1cbiAgICB3ZWJzb2NrZXQub25vcGVuID0gKCkgPT4ge1xuICAgICAgcHJvdmlkZXIud3NMYXN0TWVzc2FnZVJlY2VpdmVkID0gdGltZS5nZXRVbml4VGltZSgpXG4gICAgICBwcm92aWRlci53c2Nvbm5lY3RpbmcgPSBmYWxzZVxuICAgICAgcHJvdmlkZXIud3Njb25uZWN0ZWQgPSB0cnVlXG4gICAgICBwcm92aWRlci53c1Vuc3VjY2Vzc2Z1bFJlY29ubmVjdHMgPSAwXG4gICAgICBwcm92aWRlci5lbWl0KCdzdGF0dXMnLCBbe1xuICAgICAgICBzdGF0dXM6ICdjb25uZWN0ZWQnXG4gICAgICB9XSlcbiAgICAgIC8vIGFsd2F5cyBzZW5kIHN5bmMgc3RlcCAxIHdoZW4gY29ubmVjdGVkXG4gICAgICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlciwgbWVzc2FnZVN5bmMpXG4gICAgICBzeW5jUHJvdG9jb2wud3JpdGVTeW5jU3RlcDEoZW5jb2RlciwgcHJvdmlkZXIuZG9jKVxuICAgICAgd2Vic29ja2V0LnNlbmQoZW5jb2RpbmcudG9VaW50OEFycmF5KGVuY29kZXIpKVxuICAgICAgLy8gYnJvYWRjYXN0IGxvY2FsIGF3YXJlbmVzcyBzdGF0ZVxuICAgICAgaWYgKHByb3ZpZGVyLmF3YXJlbmVzcy5nZXRMb2NhbFN0YXRlKCkgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgZW5jb2RlckF3YXJlbmVzc1N0YXRlID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyQXdhcmVuZXNzU3RhdGUsIG1lc3NhZ2VBd2FyZW5lc3MpXG4gICAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludDhBcnJheShcbiAgICAgICAgICBlbmNvZGVyQXdhcmVuZXNzU3RhdGUsXG4gICAgICAgICAgYXdhcmVuZXNzUHJvdG9jb2wuZW5jb2RlQXdhcmVuZXNzVXBkYXRlKHByb3ZpZGVyLmF3YXJlbmVzcywgW1xuICAgICAgICAgICAgcHJvdmlkZXIuZG9jLmNsaWVudElEXG4gICAgICAgICAgXSlcbiAgICAgICAgKVxuICAgICAgICB3ZWJzb2NrZXQuc2VuZChlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlckF3YXJlbmVzc1N0YXRlKSlcbiAgICAgIH1cbiAgICB9XG4gICAgcHJvdmlkZXIuZW1pdCgnc3RhdHVzJywgW3tcbiAgICAgIHN0YXR1czogJ2Nvbm5lY3RpbmcnXG4gICAgfV0pXG4gIH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge1dlYnNvY2tldFByb3ZpZGVyfSBwcm92aWRlclxuICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gYnVmXG4gKi9cbmNvbnN0IGJyb2FkY2FzdE1lc3NhZ2UgPSAocHJvdmlkZXIsIGJ1ZikgPT4ge1xuICBjb25zdCB3cyA9IHByb3ZpZGVyLndzXG4gIGlmIChwcm92aWRlci53c2Nvbm5lY3RlZCAmJiB3cyAmJiB3cy5yZWFkeVN0YXRlID09PSB3cy5PUEVOKSB7XG4gICAgd3Muc2VuZChidWYpXG4gIH1cbiAgaWYgKHByb3ZpZGVyLmJjY29ubmVjdGVkKSB7XG4gICAgYmMucHVibGlzaChwcm92aWRlci5iY0NoYW5uZWwsIGJ1ZiwgcHJvdmlkZXIpXG4gIH1cbn1cblxuLyoqXG4gKiBXZWJzb2NrZXQgUHJvdmlkZXIgZm9yIFlqcy4gQ3JlYXRlcyBhIHdlYnNvY2tldCBjb25uZWN0aW9uIHRvIHN5bmMgdGhlIHNoYXJlZCBkb2N1bWVudC5cbiAqIFRoZSBkb2N1bWVudCBuYW1lIGlzIGF0dGFjaGVkIHRvIHRoZSBwcm92aWRlZCB1cmwuIEkuZS4gdGhlIGZvbGxvd2luZyBleGFtcGxlXG4gKiBjcmVhdGVzIGEgd2Vic29ja2V0IGNvbm5lY3Rpb24gdG8gaHR0cDovL2xvY2FsaG9zdDoxMjM0L215LWRvY3VtZW50LW5hbWVcbiAqXG4gKiBAZXhhbXBsZVxuICogICBpbXBvcnQgKiBhcyBZIGZyb20gJ3lqcydcbiAqICAgaW1wb3J0IHsgV2Vic29ja2V0UHJvdmlkZXIgfSBmcm9tICd5LXdlYnNvY2tldCdcbiAqICAgY29uc3QgZG9jID0gbmV3IFkuRG9jKClcbiAqICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgV2Vic29ja2V0UHJvdmlkZXIoJ2h0dHA6Ly9sb2NhbGhvc3Q6MTIzNCcsICdteS1kb2N1bWVudC1uYW1lJywgZG9jKVxuICpcbiAqIEBleHRlbmRzIHtPYnNlcnZhYmxlVjI8eyAnY29ubmVjdGlvbi1jbG9zZSc6IChldmVudDogQ2xvc2VFdmVudCB8IG51bGwsICBwcm92aWRlcjogV2Vic29ja2V0UHJvdmlkZXIpID0+IGFueSwgJ3N0YXR1cyc6IChldmVudDogeyBzdGF0dXM6ICdjb25uZWN0ZWQnIHwgJ2Rpc2Nvbm5lY3RlZCcgfCAnY29ubmVjdGluZycgfSkgPT4gYW55LCAnY29ubmVjdGlvbi1lcnJvcic6IChldmVudDogRXZlbnQsIHByb3ZpZGVyOiBXZWJzb2NrZXRQcm92aWRlcikgPT4gYW55LCAnc3luYyc6IChzdGF0ZTogYm9vbGVhbikgPT4gYW55IH0+fVxuICovXG5leHBvcnQgY2xhc3MgV2Vic29ja2V0UHJvdmlkZXIgZXh0ZW5kcyBPYnNlcnZhYmxlVjIge1xuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlcnZlclVybFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcm9vbW5hbWVcbiAgICogQHBhcmFtIHtZLkRvY30gZG9jXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdHMuY29ubmVjdF1cbiAgICogQHBhcmFtIHthd2FyZW5lc3NQcm90b2NvbC5Bd2FyZW5lc3N9IFtvcHRzLmF3YXJlbmVzc11cbiAgICogQHBhcmFtIHtPYmplY3Q8c3RyaW5nLHN0cmluZz59IFtvcHRzLnBhcmFtc10gc3BlY2lmeSB1cmwgcGFyYW1ldGVyc1xuICAgKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IFtvcHRzLnByb3RvY29sc10gc3BlY2lmeSB3ZWJzb2NrZXQgcHJvdG9jb2xzXG4gICAqIEBwYXJhbSB7dHlwZW9mIFdlYlNvY2tldH0gW29wdHMuV2ViU29ja2V0UG9seWZpbGxdIE9wdGlvbmFsbCBwcm92aWRlIGEgV2ViU29ja2V0IHBvbHlmaWxsXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0cy5yZXN5bmNJbnRlcnZhbF0gUmVxdWVzdCBzZXJ2ZXIgc3RhdGUgZXZlcnkgYHJlc3luY0ludGVydmFsYCBtaWxsaXNlY29uZHNcbiAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLm1heEJhY2tvZmZUaW1lXSBNYXhpbXVtIGFtb3VudCBvZiB0aW1lIHRvIHdhaXQgYmVmb3JlIHRyeWluZyB0byByZWNvbm5lY3QgKHdlIHRyeSB0byByZWNvbm5lY3QgdXNpbmcgZXhwb25lbnRpYWwgYmFja29mZilcbiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0cy5kaXNhYmxlQmNdIERpc2FibGUgY3Jvc3MtdGFiIEJyb2FkY2FzdENoYW5uZWwgY29tbXVuaWNhdGlvblxuICAgKi9cbiAgY29uc3RydWN0b3IgKHNlcnZlclVybCwgcm9vbW5hbWUsIGRvYywge1xuICAgIGNvbm5lY3QgPSB0cnVlLFxuICAgIGF3YXJlbmVzcyA9IG5ldyBhd2FyZW5lc3NQcm90b2NvbC5Bd2FyZW5lc3MoZG9jKSxcbiAgICBwYXJhbXMgPSB7fSxcbiAgICBwcm90b2NvbHMgPSBbXSxcbiAgICBXZWJTb2NrZXRQb2x5ZmlsbCA9IFdlYlNvY2tldCxcbiAgICByZXN5bmNJbnRlcnZhbCA9IC0xLFxuICAgIG1heEJhY2tvZmZUaW1lID0gMjUwMCxcbiAgICBkaXNhYmxlQmMgPSBmYWxzZVxuICB9ID0ge30pIHtcbiAgICBzdXBlcigpXG4gICAgLy8gZW5zdXJlIHRoYXQgdXJsIGlzIGFsd2F5cyBlbmRzIHdpdGggL1xuICAgIHdoaWxlIChzZXJ2ZXJVcmxbc2VydmVyVXJsLmxlbmd0aCAtIDFdID09PSAnLycpIHtcbiAgICAgIHNlcnZlclVybCA9IHNlcnZlclVybC5zbGljZSgwLCBzZXJ2ZXJVcmwubGVuZ3RoIC0gMSlcbiAgICB9XG4gICAgdGhpcy5zZXJ2ZXJVcmwgPSBzZXJ2ZXJVcmxcbiAgICB0aGlzLmJjQ2hhbm5lbCA9IHNlcnZlclVybCArICcvJyArIHJvb21uYW1lXG4gICAgdGhpcy5tYXhCYWNrb2ZmVGltZSA9IG1heEJhY2tvZmZUaW1lXG4gICAgLyoqXG4gICAgICogVGhlIHNwZWNpZmllZCB1cmwgcGFyYW1ldGVycy4gVGhpcyBjYW4gYmUgc2FmZWx5IHVwZGF0ZWQuIFRoZSBjaGFuZ2VkIHBhcmFtZXRlcnMgd2lsbCBiZSB1c2VkXG4gICAgICogd2hlbiBhIG5ldyBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkLlxuICAgICAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLHN0cmluZz59XG4gICAgICovXG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXNcbiAgICB0aGlzLnByb3RvY29scyA9IHByb3RvY29sc1xuICAgIHRoaXMucm9vbW5hbWUgPSByb29tbmFtZVxuICAgIHRoaXMuZG9jID0gZG9jXG4gICAgdGhpcy5fV1MgPSBXZWJTb2NrZXRQb2x5ZmlsbFxuICAgIHRoaXMuYXdhcmVuZXNzID0gYXdhcmVuZXNzXG4gICAgdGhpcy53c2Nvbm5lY3RlZCA9IGZhbHNlXG4gICAgdGhpcy53c2Nvbm5lY3RpbmcgPSBmYWxzZVxuICAgIHRoaXMuYmNjb25uZWN0ZWQgPSBmYWxzZVxuICAgIHRoaXMuZGlzYWJsZUJjID0gZGlzYWJsZUJjXG4gICAgdGhpcy53c1Vuc3VjY2Vzc2Z1bFJlY29ubmVjdHMgPSAwXG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlcnMgPSBtZXNzYWdlSGFuZGxlcnMuc2xpY2UoKVxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIHRoaXMuX3N5bmNlZCA9IGZhbHNlXG4gICAgLyoqXG4gICAgICogQHR5cGUge1dlYlNvY2tldD99XG4gICAgICovXG4gICAgdGhpcy53cyA9IG51bGxcbiAgICB0aGlzLndzTGFzdE1lc3NhZ2VSZWNlaXZlZCA9IDBcbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIGNvbm5lY3QgdG8gb3RoZXIgcGVlcnMgb3Igbm90XG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5zaG91bGRDb25uZWN0ID0gY29ubmVjdFxuXG4gICAgLyoqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICB0aGlzLl9yZXN5bmNJbnRlcnZhbCA9IDBcbiAgICBpZiAocmVzeW5jSW50ZXJ2YWwgPiAwKSB7XG4gICAgICB0aGlzLl9yZXN5bmNJbnRlcnZhbCA9IC8qKiBAdHlwZSB7YW55fSAqLyAoc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy53cyAmJiB0aGlzLndzLnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7XG4gICAgICAgICAgLy8gcmVzZW5kIHN5bmMgc3RlcCAxXG4gICAgICAgICAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgICAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlU3luYylcbiAgICAgICAgICBzeW5jUHJvdG9jb2wud3JpdGVTeW5jU3RlcDEoZW5jb2RlciwgZG9jKVxuICAgICAgICAgIHRoaXMud3Muc2VuZChlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgICAgIH1cbiAgICAgIH0sIHJlc3luY0ludGVydmFsKSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBkYXRhXG4gICAgICogQHBhcmFtIHthbnl9IG9yaWdpblxuICAgICAqL1xuICAgIHRoaXMuX2JjU3Vic2NyaWJlciA9IChkYXRhLCBvcmlnaW4pID0+IHtcbiAgICAgIGlmIChvcmlnaW4gIT09IHRoaXMpIHtcbiAgICAgICAgY29uc3QgZW5jb2RlciA9IHJlYWRNZXNzYWdlKHRoaXMsIG5ldyBVaW50OEFycmF5KGRhdGEpLCBmYWxzZSlcbiAgICAgICAgaWYgKGVuY29kaW5nLmxlbmd0aChlbmNvZGVyKSA+IDEpIHtcbiAgICAgICAgICBiYy5wdWJsaXNoKHRoaXMuYmNDaGFubmVsLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlciksIHRoaXMpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogTGlzdGVucyB0byBZanMgdXBkYXRlcyBhbmQgc2VuZHMgdGhlbSB0byByZW1vdGUgcGVlcnMgKHdzIGFuZCBicm9hZGNhc3RjaGFubmVsKVxuICAgICAqIEBwYXJhbSB7VWludDhBcnJheX0gdXBkYXRlXG4gICAgICogQHBhcmFtIHthbnl9IG9yaWdpblxuICAgICAqL1xuICAgIHRoaXMuX3VwZGF0ZUhhbmRsZXIgPSAodXBkYXRlLCBvcmlnaW4pID0+IHtcbiAgICAgIGlmIChvcmlnaW4gIT09IHRoaXMpIHtcbiAgICAgICAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgICAgICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlciwgbWVzc2FnZVN5bmMpXG4gICAgICAgIHN5bmNQcm90b2NvbC53cml0ZVVwZGF0ZShlbmNvZGVyLCB1cGRhdGUpXG4gICAgICAgIGJyb2FkY2FzdE1lc3NhZ2UodGhpcywgZW5jb2RpbmcudG9VaW50OEFycmF5KGVuY29kZXIpKVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRvYy5vbigndXBkYXRlJywgdGhpcy5fdXBkYXRlSGFuZGxlcilcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2FueX0gY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7YW55fSBfb3JpZ2luXG4gICAgICovXG4gICAgdGhpcy5fYXdhcmVuZXNzVXBkYXRlSGFuZGxlciA9ICh7IGFkZGVkLCB1cGRhdGVkLCByZW1vdmVkIH0sIF9vcmlnaW4pID0+IHtcbiAgICAgIGNvbnN0IGNoYW5nZWRDbGllbnRzID0gYWRkZWQuY29uY2F0KHVwZGF0ZWQpLmNvbmNhdChyZW1vdmVkKVxuICAgICAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXIsIG1lc3NhZ2VBd2FyZW5lc3MpXG4gICAgICBlbmNvZGluZy53cml0ZVZhclVpbnQ4QXJyYXkoXG4gICAgICAgIGVuY29kZXIsXG4gICAgICAgIGF3YXJlbmVzc1Byb3RvY29sLmVuY29kZUF3YXJlbmVzc1VwZGF0ZShhd2FyZW5lc3MsIGNoYW5nZWRDbGllbnRzKVxuICAgICAgKVxuICAgICAgYnJvYWRjYXN0TWVzc2FnZSh0aGlzLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgfVxuICAgIHRoaXMuX2V4aXRIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgYXdhcmVuZXNzUHJvdG9jb2wucmVtb3ZlQXdhcmVuZXNzU3RhdGVzKFxuICAgICAgICB0aGlzLmF3YXJlbmVzcyxcbiAgICAgICAgW2RvYy5jbGllbnRJRF0sXG4gICAgICAgICdhcHAgY2xvc2VkJ1xuICAgICAgKVxuICAgIH1cbiAgICBpZiAoZW52LmlzTm9kZSAmJiB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHByb2Nlc3Mub24oJ2V4aXQnLCB0aGlzLl9leGl0SGFuZGxlcilcbiAgICB9XG4gICAgYXdhcmVuZXNzLm9uKCd1cGRhdGUnLCB0aGlzLl9hd2FyZW5lc3NVcGRhdGVIYW5kbGVyKVxuICAgIHRoaXMuX2NoZWNrSW50ZXJ2YWwgPSAvKiogQHR5cGUge2FueX0gKi8gKHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy53c2Nvbm5lY3RlZCAmJlxuICAgICAgICBtZXNzYWdlUmVjb25uZWN0VGltZW91dCA8XG4gICAgICAgICAgdGltZS5nZXRVbml4VGltZSgpIC0gdGhpcy53c0xhc3RNZXNzYWdlUmVjZWl2ZWRcbiAgICAgICkge1xuICAgICAgICAvLyBubyBtZXNzYWdlIHJlY2VpdmVkIGluIGEgbG9uZyB0aW1lIC0gbm90IGV2ZW4geW91ciBvd24gYXdhcmVuZXNzXG4gICAgICAgIC8vIHVwZGF0ZXMgKHdoaWNoIGFyZSB1cGRhdGVkIGV2ZXJ5IDE1IHNlY29uZHMpXG4gICAgICAgIGNsb3NlV2Vic29ja2V0Q29ubmVjdGlvbih0aGlzLCAvKiogQHR5cGUge1dlYlNvY2tldH0gKi8gKHRoaXMud3MpLCBudWxsKVxuICAgICAgfVxuICAgIH0sIG1lc3NhZ2VSZWNvbm5lY3RUaW1lb3V0IC8gMTApKVxuICAgIGlmIChjb25uZWN0KSB7XG4gICAgICB0aGlzLmNvbm5lY3QoKVxuICAgIH1cbiAgfVxuXG4gIGdldCB1cmwgKCkge1xuICAgIGNvbnN0IGVuY29kZWRQYXJhbXMgPSB1cmwuZW5jb2RlUXVlcnlQYXJhbXModGhpcy5wYXJhbXMpXG4gICAgcmV0dXJuIHRoaXMuc2VydmVyVXJsICsgJy8nICsgdGhpcy5yb29tbmFtZSArXG4gICAgICAoZW5jb2RlZFBhcmFtcy5sZW5ndGggPT09IDAgPyAnJyA6ICc/JyArIGVuY29kZWRQYXJhbXMpXG4gIH1cblxuICAvKipcbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICBnZXQgc3luY2VkICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc3luY2VkXG4gIH1cblxuICBzZXQgc3luY2VkIChzdGF0ZSkge1xuICAgIGlmICh0aGlzLl9zeW5jZWQgIT09IHN0YXRlKSB7XG4gICAgICB0aGlzLl9zeW5jZWQgPSBzdGF0ZVxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgdGhpcy5lbWl0KCdzeW5jZWQnLCBbc3RhdGVdKVxuICAgICAgdGhpcy5lbWl0KCdzeW5jJywgW3N0YXRlXSlcbiAgICB9XG4gIH1cblxuICBkZXN0cm95ICgpIHtcbiAgICBpZiAodGhpcy5fcmVzeW5jSW50ZXJ2YWwgIT09IDApIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fcmVzeW5jSW50ZXJ2YWwpXG4gICAgfVxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fY2hlY2tJbnRlcnZhbClcbiAgICB0aGlzLmRpc2Nvbm5lY3QoKVxuICAgIGlmIChlbnYuaXNOb2RlICYmIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcHJvY2Vzcy5vZmYoJ2V4aXQnLCB0aGlzLl9leGl0SGFuZGxlcilcbiAgICB9XG4gICAgdGhpcy5hd2FyZW5lc3Mub2ZmKCd1cGRhdGUnLCB0aGlzLl9hd2FyZW5lc3NVcGRhdGVIYW5kbGVyKVxuICAgIHRoaXMuZG9jLm9mZigndXBkYXRlJywgdGhpcy5fdXBkYXRlSGFuZGxlcilcbiAgICBzdXBlci5kZXN0cm95KClcbiAgfVxuXG4gIGNvbm5lY3RCYyAoKSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUJjKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKCF0aGlzLmJjY29ubmVjdGVkKSB7XG4gICAgICBiYy5zdWJzY3JpYmUodGhpcy5iY0NoYW5uZWwsIHRoaXMuX2JjU3Vic2NyaWJlcilcbiAgICAgIHRoaXMuYmNjb25uZWN0ZWQgPSB0cnVlXG4gICAgfVxuICAgIC8vIHNlbmQgc3luYyBzdGVwMSB0byBiY1xuICAgIC8vIHdyaXRlIHN5bmMgc3RlcCAxXG4gICAgY29uc3QgZW5jb2RlclN5bmMgPSBlbmNvZGluZy5jcmVhdGVFbmNvZGVyKClcbiAgICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlclN5bmMsIG1lc3NhZ2VTeW5jKVxuICAgIHN5bmNQcm90b2NvbC53cml0ZVN5bmNTdGVwMShlbmNvZGVyU3luYywgdGhpcy5kb2MpXG4gICAgYmMucHVibGlzaCh0aGlzLmJjQ2hhbm5lbCwgZW5jb2RpbmcudG9VaW50OEFycmF5KGVuY29kZXJTeW5jKSwgdGhpcylcbiAgICAvLyBicm9hZGNhc3QgbG9jYWwgc3RhdGVcbiAgICBjb25zdCBlbmNvZGVyU3RhdGUgPSBlbmNvZGluZy5jcmVhdGVFbmNvZGVyKClcbiAgICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlclN0YXRlLCBtZXNzYWdlU3luYylcbiAgICBzeW5jUHJvdG9jb2wud3JpdGVTeW5jU3RlcDIoZW5jb2RlclN0YXRlLCB0aGlzLmRvYylcbiAgICBiYy5wdWJsaXNoKHRoaXMuYmNDaGFubmVsLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlclN0YXRlKSwgdGhpcylcbiAgICAvLyB3cml0ZSBxdWVyeUF3YXJlbmVzc1xuICAgIGNvbnN0IGVuY29kZXJBd2FyZW5lc3NRdWVyeSA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyQXdhcmVuZXNzUXVlcnksIG1lc3NhZ2VRdWVyeUF3YXJlbmVzcylcbiAgICBiYy5wdWJsaXNoKFxuICAgICAgdGhpcy5iY0NoYW5uZWwsXG4gICAgICBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlckF3YXJlbmVzc1F1ZXJ5KSxcbiAgICAgIHRoaXNcbiAgICApXG4gICAgLy8gYnJvYWRjYXN0IGxvY2FsIGF3YXJlbmVzcyBzdGF0ZVxuICAgIGNvbnN0IGVuY29kZXJBd2FyZW5lc3NTdGF0ZSA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyQXdhcmVuZXNzU3RhdGUsIG1lc3NhZ2VBd2FyZW5lc3MpXG4gICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50OEFycmF5KFxuICAgICAgZW5jb2RlckF3YXJlbmVzc1N0YXRlLFxuICAgICAgYXdhcmVuZXNzUHJvdG9jb2wuZW5jb2RlQXdhcmVuZXNzVXBkYXRlKHRoaXMuYXdhcmVuZXNzLCBbXG4gICAgICAgIHRoaXMuZG9jLmNsaWVudElEXG4gICAgICBdKVxuICAgIClcbiAgICBiYy5wdWJsaXNoKFxuICAgICAgdGhpcy5iY0NoYW5uZWwsXG4gICAgICBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlckF3YXJlbmVzc1N0YXRlKSxcbiAgICAgIHRoaXNcbiAgICApXG4gIH1cblxuICBkaXNjb25uZWN0QmMgKCkge1xuICAgIC8vIGJyb2FkY2FzdCBtZXNzYWdlIHdpdGggbG9jYWwgYXdhcmVuZXNzIHN0YXRlIHNldCB0byBudWxsIChpbmRpY2F0aW5nIGRpc2Nvbm5lY3QpXG4gICAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlQXdhcmVuZXNzKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludDhBcnJheShcbiAgICAgIGVuY29kZXIsXG4gICAgICBhd2FyZW5lc3NQcm90b2NvbC5lbmNvZGVBd2FyZW5lc3NVcGRhdGUodGhpcy5hd2FyZW5lc3MsIFtcbiAgICAgICAgdGhpcy5kb2MuY2xpZW50SURcbiAgICAgIF0sIG5ldyBNYXAoKSlcbiAgICApXG4gICAgYnJvYWRjYXN0TWVzc2FnZSh0aGlzLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgaWYgKHRoaXMuYmNjb25uZWN0ZWQpIHtcbiAgICAgIGJjLnVuc3Vic2NyaWJlKHRoaXMuYmNDaGFubmVsLCB0aGlzLl9iY1N1YnNjcmliZXIpXG4gICAgICB0aGlzLmJjY29ubmVjdGVkID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBkaXNjb25uZWN0ICgpIHtcbiAgICB0aGlzLnNob3VsZENvbm5lY3QgPSBmYWxzZVxuICAgIHRoaXMuZGlzY29ubmVjdEJjKClcbiAgICBpZiAodGhpcy53cyAhPT0gbnVsbCkge1xuICAgICAgY2xvc2VXZWJzb2NrZXRDb25uZWN0aW9uKHRoaXMsIHRoaXMud3MsIG51bGwpXG4gICAgfVxuICB9XG5cbiAgY29ubmVjdCAoKSB7XG4gICAgdGhpcy5zaG91bGRDb25uZWN0ID0gdHJ1ZVxuICAgIGlmICghdGhpcy53c2Nvbm5lY3RlZCAmJiB0aGlzLndzID09PSBudWxsKSB7XG4gICAgICBzZXR1cFdTKHRoaXMpXG4gICAgICB0aGlzLmNvbm5lY3RCYygpXG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/y-websocket/src/y-websocket.js\n");

/***/ })

};
;