(()=>{var e={};e.id=191,e.ids=[191],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6005:e=>{"use strict";e.exports=require("node:crypto")},1010:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>d,pages:()=>h,routeModule:()=>g,tree:()=>a}),r(3023),r(2029),r(5866);var s=r(3191),n=r(8716),i=r(7922),l=r.n(i),o=r(5231),c={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);r.d(t,c);let a=["",{children:["app",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3023)),"C:\\Users\\admin\\Desktop\\bianqian\\src\\app\\app\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"C:\\Users\\admin\\Desktop\\bianqian\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],h=["C:\\Users\\admin\\Desktop\\bianqian\\src\\app\\app\\page.tsx"],d="/app/page",u={require:r,loadChunk:()=>Promise.resolve()},g=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/app/page",pathname:"/app",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:a}})},9608:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},7867:(e,t,r)=>{Promise.resolve().then(r.bind(r,2812))},9301:()=>{},2812:(e,t,r)=>{"use strict";let s;r.r(t),r.d(t,{default:()=>ih});var n=r(326),i=r(7577),l=r(5047),o=r(6283),c=r(2881);let a=(0,c.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),h=(0,c.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),d=(0,c.Z)("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),u=(0,c.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),g=(0,c.Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),f=(0,c.Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),p=(0,c.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),w=(0,c.Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),m=(0,c.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),y=(0,c.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var b=r(3864);async function x(){try{return await (function(){throw Error("Database can only be accessed in the browser")})().notes.filter(e=>!e.isDeleted).reverse().sortBy("updatedAt")}catch(e){throw console.error("[DB] Error fetching notes:",e),Error("Failed to fetch notes")}}async function _(e){try{let t=new Date,r={...e,id:crypto.randomUUID(),createdAt:t,updatedAt:t,isDeleted:!1,wikiLinks:S(e.content)};return await null.notes.add(r),console.log(`[DB] Created note: ${r.id}`),r}catch(e){throw console.error("[DB] Error creating note:",e),Error("Failed to create note")}}async function k(e,t){try{let r=await null.notes.get(e);if(!r)throw Error(`Note ${e} not found`);let s={...r,...t,updatedAt:new Date,wikiLinks:t.content?S(t.content):r.wikiLinks};return await null.notes.put(s),console.log(`[DB] Updated note: ${e}`),s}catch(t){throw console.error(`[DB] Error updating note ${e}:`,t),Error(`Failed to update note ${e}`)}}async function v(e){try{await null.notes.update(e,{isDeleted:!0,updatedAt:new Date}),console.log(`[DB] Soft deleted note: ${e}`)}catch(t){throw console.error(`[DB] Error deleting note ${e}:`,t),Error(`Failed to delete note ${e}`)}}function S(e){let t;let r=/\[\[([^\]]+)\]\]/g,s=[];for(;null!==(t=r.exec(e));)s.push(t[1]);return s}b.ZP;let C=()=>new Map,D=e=>{let t=C();return e.forEach((e,r)=>{t.set(r,e)}),t},E=(e,t,r)=>{let s=e.get(t);return void 0===s&&e.set(t,s=r()),s},N=(e,t)=>{for(let[r,s]of e)if(t(s,r))return!0;return!1},j=()=>new Set,A=e=>e[e.length-1],I=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},M=Array.from,L=Array.isArray;class U{constructor(){this._observers=C()}on(e,t){return E(this._observers,e,j).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return M((this._observers.get(e)||C()).values()).forEach(e=>e(...t))}destroy(){this._observers=C()}}class O{constructor(){this._observers=C()}on(e,t){E(this._observers,e,j).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return M((this._observers.get(e)||C()).values()).forEach(e=>e(...t))}destroy(){this._observers=C()}}let R=Math.floor,T=Math.abs,P=(e,t)=>e<t?e:t,z=(e,t)=>e>t?e:t,B=Math.pow,F=e=>0!==e?e<0:1/e<0,V=Number.MAX_SAFE_INTEGER;Number.MIN_SAFE_INTEGER;let $=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&R(e)===e);Number.parseInt;let W=String.fromCharCode;String.fromCodePoint,W(65535);let J=e=>e.toLowerCase(),H=/^\s*/g,q=e=>e.replace(H,""),K=/([A-Z])/g,Z=(e,t)=>q(e.replace(K,e=>`${t}${J(e)}`)),G="undefined"!=typeof TextEncoder?new TextEncoder:null,Y=G?e=>G.encode(e):e=>{let t=unescape(encodeURIComponent(e)),r=t.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=t.codePointAt(e);return s},X="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});X&&1===X.decode(new Uint8Array).length&&(X=null);class Q{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let ee=()=>new Q,et=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},er=e=>{let t=new Uint8Array(et(e)),r=0;for(let s=0;s<e.bufs.length;s++){let n=e.bufs[s];t.set(n,r),r+=n.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},es=(e,t)=>{let r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*z(r,t)),e.cpos=0)},en=(e,t)=>{let r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*r),e.cpos=0),e.cbuf[e.cpos++]=t},ei=(e,t)=>{for(;t>127;)en(e,128|127&t),t=R(t/128);en(e,127&t)},el=(e,t)=>{let r=F(t);for(r&&(t=-t),en(e,(t>63?128:0)|(r?64:0)|63&t),t=R(t/64);t>0;)en(e,(t>127?128:0)|127&t),t=R(t/128)},eo=new Uint8Array(3e4),ec=eo.length/3,ea=G&&G.encodeInto?(e,t)=>{if(t.length<ec){let r=G.encodeInto(t,eo).written||0;ei(e,r);for(let t=0;t<r;t++)en(e,eo[t])}else ed(e,Y(t))}:(e,t)=>{let r=unescape(encodeURIComponent(t)),s=r.length;ei(e,s);for(let t=0;t<s;t++)en(e,r.codePointAt(t))},eh=(e,t)=>{let r=e.cbuf.length,s=e.cpos,n=P(r-s,t.length),i=t.length-n;e.cbuf.set(t.subarray(0,n),s),e.cpos+=n,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(z(2*r,i)),e.cbuf.set(t.subarray(n)),e.cpos=i)},ed=(e,t)=>{ei(e,t.byteLength),eh(e,t)},eu=(e,t)=>{es(e,t);let r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},eg=(e,t)=>eu(e,4).setFloat32(0,t,!1),ef=(e,t)=>eu(e,8).setFloat64(0,t,!1),ep=(e,t)=>eu(e,8).setBigInt64(0,t,!1),ew=new DataView(new ArrayBuffer(4)),em=e=>(ew.setFloat32(0,e),ew.getFloat32(0)===e),ey=(e,t)=>{switch(typeof t){case"string":en(e,119),ea(e,t);break;case"number":$(t)&&2147483647>=T(t)?(en(e,125),el(e,t)):em(t)?(en(e,124),eg(e,t)):(en(e,123),ef(e,t));break;case"bigint":en(e,122),ep(e,t);break;case"object":if(null===t)en(e,126);else if(L(t)){en(e,117),ei(e,t.length);for(let r=0;r<t.length;r++)ey(e,t[r])}else if(t instanceof Uint8Array)en(e,116),ed(e,t);else{en(e,118);let r=Object.keys(t);ei(e,r.length);for(let s=0;s<r.length;s++){let n=r[s];ea(e,n),ey(e,t[n])}}break;case"boolean":en(e,t?120:121);break;default:en(e,127)}};class eb extends Q{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ei(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}let ex=e=>{e.count>0&&(el(e.encoder,1===e.count?e.s:-e.s),e.count>1&&ei(e.encoder,e.count-2))};class e_{constructor(){this.encoder=new Q,this.s=0,this.count=0}write(e){this.s===e?this.count++:(ex(this),this.count=1,this.s=e)}toUint8Array(){return ex(this),er(this.encoder)}}let ek=e=>{if(e.count>0){let t=2*e.diff+(1===e.count?0:1);el(e.encoder,t),e.count>1&&ei(e.encoder,e.count-2)}};class ev{constructor(){this.encoder=new Q,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(ek(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return ek(this),er(this.encoder)}}class eS{constructor(){this.sarr=[],this.s="",this.lensE=new e_}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Q;return this.sarr.push(this.s),this.s="",ea(e,this.sarr.join("")),eh(e,this.lensE.toUint8Array()),er(e)}}let eC=e=>Error(e),eD=()=>{throw eC("Method unimplemented")},eE=()=>{throw eC("Unexpected case")},eN=eC("Unexpected end of array"),ej=eC("Integer out of Range");class eA{constructor(e){this.arr=e,this.pos=0}}let eI=e=>new eA(e),eM=e=>e.pos!==e.arr.length,eL=(e,t)=>{let r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},eU=e=>eL(e,eR(e)),eO=e=>e.arr[e.pos++],eR=e=>{let t=0,r=1,s=e.arr.length;for(;e.pos<s;){let s=e.arr[e.pos++];if(t+=(127&s)*r,r*=128,s<128)return t;if(t>V)throw ej}throw eN},eT=e=>{let t=e.arr[e.pos++],r=63&t,s=64,n=(64&t)>0?-1:1;if((128&t)==0)return n*r;let i=e.arr.length;for(;e.pos<i;){if(r+=(127&(t=e.arr[e.pos++]))*s,s*=128,t<128)return n*r;if(r>V)throw ej}throw eN},eP=X?e=>X.decode(eU(e)):e=>{let t=eR(e);if(0===t)return"";{let r=String.fromCodePoint(eO(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(eO(e));else for(;t>0;){let s=t<1e4?t:1e4,n=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,r+=String.fromCodePoint.apply(null,n),t-=s}return decodeURIComponent(escape(r))}},ez=(e,t)=>{let r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},eB=[e=>void 0,e=>null,eT,e=>ez(e,4).getFloat32(0,!1),e=>ez(e,8).getFloat64(0,!1),e=>ez(e,8).getBigInt64(0,!1),e=>!1,e=>!0,eP,e=>{let t=eR(e),r={};for(let s=0;s<t;s++)r[eP(e)]=eF(e);return r},e=>{let t=eR(e),r=[];for(let s=0;s<t;s++)r.push(eF(e));return r},eU],eF=e=>eB[127-eO(e)](e);class eV extends eA{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),eM(this)?this.count=eR(this)+1:this.count=-1),this.count--,this.s}}class e$ extends eA{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=eT(this);let e=F(this.s);this.count=1,e&&(this.s=-this.s,this.count=eR(this)+2)}return this.count--,this.s}}class eW extends eA{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){let e=eT(this);this.diff=R(e/2),this.count=1,1&e&&(this.count=eR(this)+2)}return this.s+=this.diff,this.count--,this.s}}class eJ{constructor(e){this.decoder=new e$(e),this.str=eP(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}var eH=r(6005);eH.webcrypto.subtle;let eq=eH.webcrypto.getRandomValues.bind(eH.webcrypto),eK=()=>eq(new Uint32Array(1))[0],eZ=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^eK()&15>>e/4).toString(16)),eG=e=>new Promise(e);Promise.all.bind(Promise);let eY=e=>void 0===e?null:e;class eX{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let eQ=new eX,e0=!0;try{"undefined"!=typeof localStorage&&localStorage&&(eQ=localStorage,e0=!1)}catch(e){}let e1=eQ,e2=e=>e0||addEventListener("storage",e),e3=e=>e0||removeEventListener("storage",e),e8=Symbol("Equality"),e4=(e,t)=>e===t||!!e?.[e8]?.(t),e6=Object.assign,e5=Object.keys;Object.values;let e7=(e,t)=>{for(let r in e)t(e[r],r)},e9=(e,t)=>{let r=[];for(let s in e)r.push(t(e[s],s));return r},te=e=>e5(e).length,tt=e=>{for(let t in e)return!1;return!0},tr=(e,t)=>{for(let r in e)if(!t(e[r],r))return!1;return!0},ts=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),tn=(e,t)=>e===t||te(e)===te(t)&&tr(e,(e,r)=>(void 0!==e||ts(t,r))&&e4(t[r],e)),ti=Object.freeze,tl=e=>{for(let t in e){let r=e[t];("object"==typeof r||"function"==typeof r)&&tl(e[t])}return ti(e)},to=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&to(e,t,r+1)}},tc=e=>e,ta=(e,t)=>{if(e===t)return!0;if(null==e||null==t||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(null!=e[e8])return e[e8](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;break;case Set:if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;break;case Map:if(e.size!==t.size)return!1;for(let r of e.keys())if(!t.has(r)||!ta(e.get(r),t.get(r)))return!1;break;case void 0:case Object:if(te(e)!==te(t))return!1;for(let r in e)if(!ts(e,r)||!ta(e[r],t[r]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!ta(e[r],t[r]))return!1;break;default:return!1}return!0},th="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),td="undefined"!=typeof window&&"undefined"!=typeof document&&!th;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let tu=[],tg=()=>{if(void 0===s){if(th){s=C();let e=process.argv,t=null;for(let r=0;r<e.length;r++){let n=e[r];"-"===n[0]?(null!==t&&s.set(t,""),t=n):null!==t?(s.set(t,n),t=null):tu.push(n)}null!==t&&s.set(t,"")}else"object"==typeof location?(s=C(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){let[t,r]=e.split("=");s.set(`--${Z(t,"-")}`,r),s.set(`-${Z(t,"-")}`,r)}})):s=C()}return s},tf=e=>tg().has(e),tp=e=>th?eY(process.env[e.toUpperCase().replaceAll("-","_")]):eY(e1.getItem(e)),tw=e=>tf("--"+e)||null!==tp(e);tw("production");let tm=th&&["true","1","2"].includes(process.env.FORCE_COLOR)||!tf("--no-colors")&&!tw("no-color")&&(!th||process.stdout.isTTY)&&(!th||tf("--color")||null!==tp("COLORTERM")||(tp("TERM")||"").includes("color")),ty=e=>new Uint8Array(e),tb=(e,t,r)=>new Uint8Array(e,t,r),tx=e=>new Uint8Array(e),t_=td?e=>{let t="";for(let r=0;r<e.byteLength;r++)t+=W(e[r]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),tk=td?e=>{let t=atob(e),r=ty(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}:e=>{let t=Buffer.from(e,"base64");return tb(t.buffer,t.byteOffset,t.byteLength)},tv=e=>{let t=ty(e.byteLength);return t.set(e),t},tS=Symbol,tC=Date.now,tD=tS(),tE=tS(),tN=tS(),tj=tS(),tA=tS(),tI=tS(),tM=tS(),tL=tS(),tU=tS();tC();let tO={[tD]:"\x1b[1m",[tE]:"\x1b[2m",[tN]:"\x1b[34m",[tA]:"\x1b[32m",[tj]:"\x1b[37m",[tI]:"\x1b[31m",[tM]:"\x1b[35m",[tL]:"\x1b[38;5;208m",[tU]:"\x1b[0m"},tR=tm?e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],s=0;for(;s<e.length;s++){let r=e[s],n=tO[r];if(void 0!==n)t.push(n);else{if(void 0===r)break;if(r.constructor===String||r.constructor===Number)t.push(r);else break}}for(s>0&&(t.push("\x1b[0m"),r.push(t.join("")));s<e.length;s++){let t=e[s];t instanceof Symbol||r.push(t)}return r}:e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],s=0;for(;s<e.length;s++){let r=e[s];if(void 0===r)break;if(r.constructor===String||r.constructor===Number)t.push(r);else if(r.constructor===Object)break}for(s>0&&r.push(t.join(""));s<e.length;s++){let t=e[s];t instanceof Symbol||r.push(t)}return r},tT=(...e)=>{console.log(...tR(e))},tP=(...e)=>{console.warn(...tR(e))},tz=e=>({[Symbol.iterator](){return this},next:e}),tB=(e,t)=>tz(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),tF=(e,t)=>tz(()=>{let{done:r,value:s}=e.next();return{done:r,value:r?void 0:t(s)}});class tV{constructor(e,t){this.clock=e,this.len=t}}class t${constructor(){this.clients=new Map}}let tW=(e,t,r)=>t.clients.forEach((t,s)=>{let n=e.doc.store.clients.get(s);if(null!=n){let s=n[n.length-1],i=s.id.clock+s.length;for(let s=0,l=t[s];s<t.length&&l.clock<i;l=t[++s])rz(e,n,l.clock,l.len,r)}}),tJ=(e,t)=>{let r=0,s=e.length-1;for(;r<=s;){let n=R((r+s)/2),i=e[n],l=i.clock;if(l<=t){if(t<l+i.len)return n;r=n+1}else s=n-1}return null},tH=(e,t)=>{let r=e.clients.get(t.client);return void 0!==r&&null!==tJ(r,t.clock)},tq=e=>{e.clients.forEach(e=>{let t,r;for(e.sort((e,t)=>e.clock-t.clock),t=1,r=1;t<e.length;t++){let s=e[r-1],n=e[t];s.clock+s.len>=n.clock?s.len=z(s.len,n.clock+n.len-s.clock):(r<t&&(e[r]=n),r++)}e.length=r})},tK=e=>{let t=new t$;for(let r=0;r<e.length;r++)e[r].clients.forEach((s,n)=>{if(!t.clients.has(n)){let i=s.slice();for(let t=r+1;t<e.length;t++)I(i,e[t].clients.get(n)||[]);t.clients.set(n,i)}});return tq(t),t},tZ=(e,t,r,s)=>{E(e.clients,t,()=>[]).push(new tV(r,s))},tG=()=>new t$,tY=e=>{let t=tG();return e.clients.forEach((e,r)=>{let s=[];for(let t=0;t<e.length;t++){let r=e[t];if(r.deleted){let n=r.id.clock,i=r.length;if(t+1<e.length)for(let r=e[t+1];t+1<e.length&&r.deleted;r=e[++t+1])i+=r.length;s.push(new tV(n,i))}}s.length>0&&t.clients.set(r,s)}),t},tX=(e,t)=>{ei(e.restEncoder,t.clients.size),M(t.clients.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{e.resetDsCurVal(),ei(e.restEncoder,t);let s=r.length;ei(e.restEncoder,s);for(let t=0;t<s;t++){let s=r[t];e.writeDsClock(s.clock),e.writeDsLen(s.len)}})},tQ=e=>{let t=new t$,r=eR(e.restDecoder);for(let s=0;s<r;s++){e.resetDsCurVal();let r=eR(e.restDecoder),s=eR(e.restDecoder);if(s>0){let n=E(t.clients,r,()=>[]);for(let t=0;t<s;t++)n.push(new tV(e.readDsClock(),e.readDsLen()))}}return t},t0=(e,t,r)=>{let s=new t$,n=eR(e.restDecoder);for(let i=0;i<n;i++){e.resetDsCurVal();let n=eR(e.restDecoder),i=eR(e.restDecoder),l=r.clients.get(n)||[],o=rI(r,n);for(let r=0;r<i;r++){let r=e.readDsClock(),i=r+e.readDsLen();if(r<o){o<i&&tZ(s,n,o,i-o);let e=rL(l,r),c=l[e];for(!c.deleted&&c.id.clock<r&&(l.splice(e+1,0,nh(t,c,r-c.id.clock)),e++);e<l.length;)if((c=l[e++]).id.clock<i)c.deleted||(i<c.id.clock+c.length&&l.splice(e,0,nh(t,c,i-c.id.clock)),c.delete(t));else break}else tZ(s,n,r,i-r)}}if(s.clients.size>0){let e=new t9;return ei(e.restEncoder,0),tX(e,s),e.toUint8Array()}return null};class t1 extends U{constructor({guid:e=eZ(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:n=null,autoLoad:i=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=eK(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new rj,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=i,this.meta=n,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=eG(e=>{this.on("load",()=>{this.isLoaded=!0,e(this)})});let o=()=>eG(e=>{let t=r=>{(void 0===r||!0===r)&&(this.off("sync",t),e())};this.on("sync",t)});this.on("sync",e=>{!1===e&&this.isSynced&&(this.whenSynced=o()),this.isSynced=void 0===e||!0===e,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=o()}load(){let e=this._item;null===e||this.shouldLoad||rq(e.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(M(this.subdocs).map(e=>e.guid))}transact(e,t=null){return rq(this,e,t)}get(e,t=so){let r=E(this.share,e,()=>{let e=new t;return e._integrate(this,null),e}),s=r.constructor;if(t!==so&&s!==t){if(s===so){let s=new t;s._map=r._map,r._map.forEach(e=>{for(;null!==e;e=e.left)e.parent=s}),s._start=r._start;for(let e=s._start;null!==e;e=e.right)e.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}throw Error(`Type with the name ${e} has already been defined with a different constructor`)}return r}getArray(e=""){return this.get(e,sE)}getText(e=""){return this.get(e,sH)}getMap(e=""){return this.get(e,sj)}getXmlElement(e=""){return this.get(e,sZ)}getXmlFragment(e=""){return this.get(e,sK)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,M(this.subdocs).forEach(e=>e.destroy());let e=this._item;if(null!==e){this._item=null;let t=e.content;t.doc=new t1({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,rq(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class t2{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return eR(this.restDecoder)}readDsLen(){return eR(this.restDecoder)}}class t3 extends t2{readLeftID(){return rS(eR(this.restDecoder),eR(this.restDecoder))}readRightID(){return rS(eR(this.restDecoder),eR(this.restDecoder))}readClient(){return eR(this.restDecoder)}readInfo(){return eO(this.restDecoder)}readString(){return eP(this.restDecoder)}readParentInfo(){return 1===eR(this.restDecoder)}readTypeRef(){return eR(this.restDecoder)}readLen(){return eR(this.restDecoder)}readAny(){return eF(this.restDecoder)}readBuf(){return tv(eU(this.restDecoder))}readJSON(){return JSON.parse(eP(this.restDecoder))}readKey(){return eP(this.restDecoder)}}class t8{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=eR(this.restDecoder),this.dsCurrVal}readDsLen(){let e=eR(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class t4 extends t8{constructor(e){super(e),this.keys=[],eR(e),this.keyClockDecoder=new eW(eU(e)),this.clientDecoder=new e$(eU(e)),this.leftClockDecoder=new eW(eU(e)),this.rightClockDecoder=new eW(eU(e)),this.infoDecoder=new eV(eU(e),eO),this.stringDecoder=new eJ(eU(e)),this.parentInfoDecoder=new eV(eU(e),eO),this.typeRefDecoder=new e$(eU(e)),this.lenDecoder=new e$(eU(e))}readLeftID(){return new rk(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new rk(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return eF(this.restDecoder)}readBuf(){return eU(this.restDecoder)}readJSON(){return eF(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let e=this.stringDecoder.read();return this.keys.push(e),e}}}class t6{constructor(){this.restEncoder=ee()}toUint8Array(){return er(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ei(this.restEncoder,e)}writeDsLen(e){ei(this.restEncoder,e)}}class t5 extends t6{writeLeftID(e){ei(this.restEncoder,e.client),ei(this.restEncoder,e.clock)}writeRightID(e){ei(this.restEncoder,e.client),ei(this.restEncoder,e.clock)}writeClient(e){ei(this.restEncoder,e)}writeInfo(e){en(this.restEncoder,e)}writeString(e){ea(this.restEncoder,e)}writeParentInfo(e){ei(this.restEncoder,e?1:0)}writeTypeRef(e){ei(this.restEncoder,e)}writeLen(e){ei(this.restEncoder,e)}writeAny(e){ey(this.restEncoder,e)}writeBuf(e){ed(this.restEncoder,e)}writeJSON(e){ea(this.restEncoder,JSON.stringify(e))}writeKey(e){ea(this.restEncoder,e)}}class t7{constructor(){this.restEncoder=ee(),this.dsCurrVal=0}toUint8Array(){return er(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,ei(this.restEncoder,t)}writeDsLen(e){0===e&&eE(),ei(this.restEncoder,e-1),this.dsCurrVal+=e}}class t9 extends t7{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ev,this.clientEncoder=new e_,this.leftClockEncoder=new ev,this.rightClockEncoder=new ev,this.infoEncoder=new eb(en),this.stringEncoder=new eS,this.parentInfoEncoder=new eb(en),this.typeRefEncoder=new e_,this.lenEncoder=new e_}toUint8Array(){let e=ee();return ei(e,0),ed(e,this.keyClockEncoder.toUint8Array()),ed(e,this.clientEncoder.toUint8Array()),ed(e,this.leftClockEncoder.toUint8Array()),ed(e,this.rightClockEncoder.toUint8Array()),ed(e,er(this.infoEncoder)),ed(e,this.stringEncoder.toUint8Array()),ed(e,er(this.parentInfoEncoder)),ed(e,this.typeRefEncoder.toUint8Array()),ed(e,this.lenEncoder.toUint8Array()),eh(e,er(this.restEncoder)),er(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ey(this.restEncoder,e)}writeBuf(e){ed(this.restEncoder,e)}writeJSON(e){ey(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}let re=(e,t,r,s)=>{s=z(s,t[0].id.clock);let n=rL(t,s);ei(e.restEncoder,t.length-n),e.writeClient(r),ei(e.restEncoder,s);let i=t[n];i.write(e,s-i.id.clock);for(let r=n+1;r<t.length;r++)t[r].write(e,0)},rt=(e,t,r)=>{let s=new Map;r.forEach((e,r)=>{rI(t,r)>e&&s.set(r,e)}),rA(t).forEach((e,t)=>{r.has(t)||s.set(t,0)}),ei(e.restEncoder,s.size),M(s.entries()).sort((e,t)=>t[0]-e[0]).forEach(([r,s])=>{re(e,t.clients.get(r),r,s)})},rr=(e,t)=>{let r=C(),s=eR(e.restDecoder);for(let n=0;n<s;n++){let s=eR(e.restDecoder),n=Array(s),i=e.readClient(),l=eR(e.restDecoder);r.set(i,{i:0,refs:n});for(let r=0;r<s;r++){let s=e.readInfo();switch(31&s){case 0:{let t=e.readLen();n[r]=new s0(rS(i,l),t),l+=t;break}case 10:{let t=eR(e.restDecoder);n[r]=new nf(rS(i,l),t),l+=t;break}default:{let o=(192&s)==0,c=new nd(rS(i,l),null,(128&s)==128?e.readLeftID():null,null,(64&s)==64?e.readRightID():null,o?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,o&&(32&s)==32?e.readString():null,nu(e,s));n[r]=c,l+=c.length}}}}return r},rs=(e,t,r)=>{let s=[],n=M(r.keys()).sort((e,t)=>e-t);if(0===n.length)return null;let i=()=>{if(0===n.length)return null;let e=r.get(n[n.length-1]);for(;e.refs.length===e.i;){if(n.pop(),!(n.length>0))return null;e=r.get(n[n.length-1])}return e},l=i();if(null===l)return null;let o=new rj,c=new Map,a=(e,t)=>{let r=c.get(e);(null==r||r>t)&&c.set(e,t)},h=l.refs[l.i++],d=new Map,u=()=>{for(let e of s){let t=e.id.client,s=r.get(t);s?(s.i--,o.clients.set(t,s.refs.slice(s.i)),r.delete(t),s.i=0,s.refs=[]):o.clients.set(t,[e]),n=n.filter(e=>e!==t)}s.length=0};for(;;){if(h.constructor!==nf){let n=E(d,h.id.client,()=>rI(t,h.id.client))-h.id.clock;if(n<0)s.push(h),a(h.id.client,h.id.clock-1),u();else{let i=h.getMissing(e,t);if(null!==i){s.push(h);let e=r.get(i)||{refs:[],i:0};if(e.refs.length===e.i)a(i,rI(t,i)),u();else{h=e.refs[e.i++];continue}}else(0===n||n<h.length)&&(h.integrate(e,n),d.set(h.id.client,h.id.clock+h.length))}}if(s.length>0)h=s.pop();else if(null!==l&&l.i<l.refs.length)h=l.refs[l.i++];else{if(null===(l=i()))break;h=l.refs[l.i++]}}if(o.clients.size>0){let e=new t9;return rt(e,o,new Map),ei(e.restEncoder,0),{missing:c,update:e.toUint8Array()}}return null},rn=(e,t)=>rt(e,t.doc.store,t.beforeState),ri=(e,t,r,s=new t4(e))=>rq(t,e=>{e.local=!1;let t=!1,r=e.doc,n=r.store,i=rs(e,n,rr(s,r)),l=n.pendingStructs;if(l){for(let[e,r]of l.missing)if(r<rI(n,e)){t=!0;break}if(i){for(let[e,t]of i.missing){let r=l.missing.get(e);(null==r||r>t)&&l.missing.set(e,t)}l.update=rX([l.update,i.update])}}else n.pendingStructs=i;let o=t0(s,e,n);if(n.pendingDs){let t=new t4(eI(n.pendingDs));eR(t.restDecoder);let r=t0(t,e,n);o&&r?n.pendingDs=rX([o,r]):n.pendingDs=o||r}else n.pendingDs=o;if(t){let t=n.pendingStructs.update;n.pendingStructs=null,rl(e.doc,t)}},r,!1),rl=(e,t,r,s=t4)=>{let n=eI(t);ri(n,e,r,new s(n))},ro=(e,t,r)=>rl(e,t,r,t3),rc=(e,t,r=new Map)=>{rt(e,t.store,r),tX(e,tY(t.store))},ra=(e,t=new Uint8Array([0]),r=new t9)=>{rc(r,e,ru(t));let s=[r.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(rQ(e.store.pendingStructs.update,t)),s.length>1){if(r.constructor===t5)return rG(s.map((e,t)=>0===t?e:r8(e)));if(r.constructor===t9)return rX(s)}return s[0]},rh=(e,t)=>ra(e,t,new t5),rd=e=>{let t=new Map,r=eR(e.restDecoder);for(let s=0;s<r;s++){let r=eR(e.restDecoder),s=eR(e.restDecoder);t.set(r,s)}return t},ru=e=>rd(new t2(eI(e))),rg=(e,t)=>(ei(e.restEncoder,t.size),M(t.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{ei(e.restEncoder,t),ei(e.restEncoder,r)}),e),rf=(e,t)=>rg(e,rA(t.store)),rp=(e,t=new t7)=>(e instanceof Map?rg(t,e):rf(t,e),t.toUint8Array()),rw=e=>rp(e,new t6);class rm{constructor(){this.l=[]}}let ry=()=>new rm,rb=(e,t)=>e.l.push(t),rx=(e,t)=>{let r=e.l,s=r.length;e.l=r.filter(e=>t!==e),s===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},r_=(e,t,r)=>to(e.l,[t,r]);class rk{constructor(e,t){this.client=e,this.clock=t}}let rv=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,rS=(e,t)=>new rk(e,t),rC=e=>{for(let[t,r]of e.doc.share.entries())if(r===e)return t;throw eE()};class rD{constructor(e,t){this.ds=e,this.sv=t}}new rD(tG(),new Map);let rE=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!tH(t.ds,e.id),rN=(e,t)=>{let r=E(e.meta,rN,j),s=e.doc.store;r.has(t)||(t.sv.forEach((t,r)=>{t<rI(s,r)&&rR(e,rS(r,t))}),tW(e,t.ds,e=>{}),r.add(t))};class rj{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}let rA=e=>{let t=new Map;return e.clients.forEach((e,r)=>{let s=e[e.length-1];t.set(r,s.id.clock+s.length)}),t},rI=(e,t)=>{let r=e.clients.get(t);if(void 0===r)return 0;let s=r[r.length-1];return s.id.clock+s.length},rM=(e,t)=>{let r=e.clients.get(t.id.client);if(void 0===r)r=[],e.clients.set(t.id.client,r);else{let e=r[r.length-1];if(e.id.clock+e.length!==t.id.clock)throw eE()}r.push(t)},rL=(e,t)=>{let r=0,s=e.length-1,n=e[s],i=n.id.clock;if(i===t)return s;let l=R(t/(i+n.length-1)*s);for(;r<=s;){if((i=(n=e[l]).id.clock)<=t){if(t<i+n.length)return l;r=l+1}else s=l-1;l=R((r+s)/2)}throw eE()},rU=(e,t)=>{let r=e.clients.get(t.client);return r[rL(r,t.clock)]},rO=(e,t,r)=>{let s=rL(t,r),n=t[s];return n.id.clock<r&&n instanceof nd?(t.splice(s+1,0,nh(e,n,r-n.id.clock)),s+1):s},rR=(e,t)=>{let r=e.doc.store.clients.get(t.client);return r[rO(e,r,t.clock)]},rT=(e,t,r)=>{let s=t.clients.get(r.client),n=rL(s,r.clock),i=s[n];return r.clock!==i.id.clock+i.length-1&&i.constructor!==s0&&s.splice(n+1,0,nh(e,i,r.clock-i.id.clock+1)),i},rP=(e,t,r)=>{let s=e.clients.get(t.id.client);s[rL(s,t.id.clock)]=r},rz=(e,t,r,s,n)=>{let i;if(0===s)return;let l=r+s,o=rO(e,t,r);do l<(i=t[o++]).id.clock+i.length&&rO(e,t,l),n(i);while(o<t.length&&t[o].id.clock<l)};class rB{constructor(e,t,r){this.doc=e,this.deleteSet=new t$,this.beforeState=rA(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}let rF=(e,t)=>!!(0!==t.deleteSet.clients.size||N(t.afterState,(e,r)=>t.beforeState.get(r)!==e))&&(tq(t.deleteSet),rn(e,t),tX(e,t.deleteSet),!0),rV=(e,t,r)=>{let s=t._item;(null===s||s.id.clock<(e.beforeState.get(s.id.client)||0)&&!s.deleted)&&E(e.changed,t,j).add(r)},r$=(e,t)=>{let r=e[t],s=e[t-1],n=t;for(;n>0;r=s,s=e[--n-1]){if(s.deleted===r.deleted&&s.constructor===r.constructor&&s.mergeWith(r)){r instanceof nd&&null!==r.parentSub&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,s);continue}break}let i=t-n;return i&&e.splice(t+1-i,i),i},rW=(e,t,r)=>{for(let[s,n]of e.clients.entries()){let e=t.clients.get(s);for(let s=n.length-1;s>=0;s--){let i=n[s],l=i.clock+i.len;for(let s=rL(e,i.clock),n=e[s];s<e.length&&n.id.clock<l;n=e[++s]){let n=e[s];if(i.clock+i.len<=n.id.clock)break;n instanceof nd&&n.deleted&&!n.keep&&r(n)&&n.gc(t,!1)}}}},rJ=(e,t)=>{e.clients.forEach((e,r)=>{let s=t.clients.get(r);for(let t=e.length-1;t>=0;t--){let r=e[t],n=P(s.length-1,1+rL(s,r.clock+r.len-1));for(let e=n,t=s[e];e>0&&t.id.clock>=r.clock;t=s[e])e-=1+r$(s,e)}})},rH=(e,t)=>{if(t<e.length){let r=e[t],s=r.doc,n=s.store,i=r.deleteSet,l=r._mergeStructs;try{tq(i),r.afterState=rA(r.doc.store),s.emit("beforeObserverCalls",[r,s]);let e=[];r.changed.forEach((t,s)=>e.push(()=>{null!==s._item&&s._item.deleted||s._callObserver(r,t)})),e.push(()=>{r.changedParentTypes.forEach((t,s)=>{s._dEH.l.length>0&&(null===s._item||!s._item.deleted)&&((t=t.filter(e=>null===e.target._item||!e.target._item.deleted)).forEach(e=>{e.currentTarget=s,e._path=null}),t.sort((e,t)=>e.path.length-t.path.length),e.push(()=>{r_(s._dEH,t,r)}))}),e.push(()=>s.emit("afterTransaction",[r,s])),e.push(()=>{r._needFormattingCleanup&&s$(r)})}),to(e,[])}finally{s.gc&&rW(i,n,s.gcFilter),rJ(i,n),r.afterState.forEach((e,t)=>{let s=r.beforeState.get(t)||0;if(s!==e){let e=n.clients.get(t),r=z(rL(e,s),1);for(let t=e.length-1;t>=r;)t-=1+r$(e,t)}});for(let e=l.length-1;e>=0;e--){let{client:t,clock:r}=l[e].id,s=n.clients.get(t),i=rL(s,r);!(i+1<s.length&&r$(s,i+1)>1)&&i>0&&r$(s,i)}if(r.local||r.afterState.get(s.clientID)===r.beforeState.get(s.clientID)||(tT(tL,tD,"[yjs] ",tE,tI,"Changed the client-id because another client seems to be using it."),s.clientID=eK()),s.emit("afterTransactionCleanup",[r,s]),s._observers.has("update")){let e=new t5;rF(e,r)&&s.emit("update",[e.toUint8Array(),r.origin,s,r])}if(s._observers.has("updateV2")){let e=new t9;rF(e,r)&&s.emit("updateV2",[e.toUint8Array(),r.origin,s,r])}let{subdocsAdded:o,subdocsLoaded:c,subdocsRemoved:a}=r;(o.size>0||a.size>0||c.size>0)&&(o.forEach(e=>{e.clientID=s.clientID,null==e.collectionid&&(e.collectionid=s.collectionid),s.subdocs.add(e)}),a.forEach(e=>s.subdocs.delete(e)),s.emit("subdocs",[{loaded:c,added:o,removed:a},s,r]),a.forEach(e=>e.destroy())),e.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,e])):rH(e,t+1)}}},rq=(e,t,r=null,s=!0)=>{let n=e._transactionCleanups,i=!1,l=null;null===e._transaction&&(i=!0,e._transaction=new rB(e,r,s),n.push(e._transaction),1===n.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{l=t(e._transaction)}finally{if(i){let t=e._transaction===n[0];e._transaction=null,t&&rH(n,0)}}return l};class rK{constructor(e,t){this.gen=function*(e){let t=eR(e.restDecoder);for(let r=0;r<t;r++){let t=eR(e.restDecoder),r=e.readClient(),s=eR(e.restDecoder);for(let n=0;n<t;n++){let t=e.readInfo();if(10===t){let t=eR(e.restDecoder);yield new nf(rS(r,s),t),s+=t}else if((31&t)!=0){let n=(192&t)==0,i=new nd(rS(r,s),null,(128&t)==128?e.readLeftID():null,null,(64&t)==64?e.readRightID():null,n?e.readParentInfo()?e.readString():e.readLeftID():null,n&&(32&t)==32?e.readString():null,nu(e,t));yield i,s+=i.length}else{let t=e.readLen();yield new s0(rS(r,s),t),s+=t}}}}(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===nf);return this.curr}}class rZ{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}let rG=e=>rX(e,t3,t5),rY=(e,t)=>{if(e.constructor===s0){let{client:r,clock:s}=e.id;return new s0(rS(r,s+t),e.length-t)}if(e.constructor===nf){let{client:r,clock:s}=e.id;return new nf(rS(r,s+t),e.length-t)}{let{client:r,clock:s}=e.id;return new nd(rS(r,s+t),null,rS(r,s+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},rX=(e,t=t4,r=t9)=>{if(1===e.length)return e[0];let s=e.map(e=>new t(eI(e))),n=s.map(e=>new rK(e,!0)),i=null,l=new r,o=new rZ(l);for(;(n=n.filter(e=>null!==e.curr)).sort((e,t)=>{if(e.curr.id.client!==t.curr.id.client)return t.curr.id.client-e.curr.id.client;{let r=e.curr.id.clock-t.curr.id.clock;return 0===r?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===nf?1:-1:r}}),0!==n.length;){let e=n[0],t=e.curr.id.client;if(null!==i){let r=e.curr,s=!1;for(;null!==r&&r.id.clock+r.length<=i.struct.id.clock+i.struct.length&&r.id.client>=i.struct.id.client;)r=e.next(),s=!0;if(null===r||r.id.client!==t||s&&r.id.clock>i.struct.id.clock+i.struct.length)continue;if(t!==i.struct.id.client)r1(o,i.struct,i.offset),i={struct:r,offset:0},e.next();else if(i.struct.id.clock+i.struct.length<r.id.clock){if(i.struct.constructor===nf)i.struct.length=r.id.clock+r.length-i.struct.id.clock;else{r1(o,i.struct,i.offset);let e=r.id.clock-i.struct.id.clock-i.struct.length;i={struct:new nf(rS(t,i.struct.id.clock+i.struct.length),e),offset:0}}}else{let t=i.struct.id.clock+i.struct.length-r.id.clock;t>0&&(i.struct.constructor===nf?i.struct.length-=t:r=rY(r,t)),i.struct.mergeWith(r)||(r1(o,i.struct,i.offset),i={struct:r,offset:0},e.next())}}else i={struct:e.curr,offset:0},e.next();for(let r=e.curr;null!==r&&r.id.client===t&&r.id.clock===i.struct.id.clock+i.struct.length&&r.constructor!==nf;r=e.next())r1(o,i.struct,i.offset),i={struct:r,offset:0}}return null!==i&&(r1(o,i.struct,i.offset),i=null),r2(o),tX(l,tK(s.map(e=>tQ(e)))),l.toUint8Array()},rQ=(e,t,r=t4,s=t9)=>{let n=ru(t),i=new s,l=new rZ(i),o=new r(eI(e)),c=new rK(o,!1);for(;c.curr;){let e=c.curr,t=e.id.client,r=n.get(t)||0;if(c.curr.constructor===nf){c.next();continue}if(e.id.clock+e.length>r)for(r1(l,e,z(r-e.id.clock,0)),c.next();c.curr&&c.curr.id.client===t;)r1(l,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===t&&c.curr.id.clock+c.curr.length<=r;)c.next()}return r2(l),tX(i,tQ(o)),i.toUint8Array()},r0=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:er(e.encoder.restEncoder)}),e.encoder.restEncoder=ee(),e.written=0)},r1=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&r0(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ei(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},r2=e=>{r0(e);let t=e.encoder.restEncoder;ei(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){let s=e.clientStructs[r];ei(t,s.written),eh(t,s.restEncoder)}},r3=(e,t,r,s)=>{let n=new r(eI(e)),i=new rK(n,!1),l=new s,o=new rZ(l);for(let e=i.curr;null!==e;e=i.next())r1(o,t(e),0);return r2(o),tX(l,tQ(n)),l.toUint8Array()},r8=e=>r3(e,tc,t4,t5),r4="You must not compute changes after the event-handler fired.";class r6{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=r5(this.currentTarget,this.target))}deletes(e){return tH(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw eC(r4);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(r=>{if(null!==r){let s,n;let i=t._map.get(r);if(this.adds(i)){let e=i.left;for(;null!==e&&this.adds(e);)e=e.left;if(this.deletes(i)){if(!(null!==e&&this.deletes(e)))return;s="delete",n=A(e.content.getContent())}else null!==e&&this.deletes(e)?(s="update",n=A(e.content.getContent())):(s="add",n=void 0)}else{if(!this.deletes(i))return;s="delete",n=A(i.content.getContent())}e.set(r,{action:s,oldValue:n})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){if(0===this.transaction.doc._transactionCleanups.length)throw eC(r4);let t=this.target,r=j(),s=j(),n=[];if(e={added:r,deleted:s,delta:n,keys:this.keys},this.transaction.changed.get(t).has(null)){let e=null,i=()=>{e&&n.push(e)};for(let n=t._start;null!==n;n=n.right)n.deleted?this.deletes(n)&&!this.adds(n)&&((null===e||void 0===e.delete)&&(i(),e={delete:0}),e.delete+=n.length,s.add(n)):this.adds(n)?((null===e||void 0===e.insert)&&(i(),e={insert:[]}),e.insert=e.insert.concat(n.content.getContent()),r.add(n)):((null===e||void 0===e.retain)&&(i(),e={retain:0}),e.retain+=n.length);null!==e&&void 0===e.retain&&i()}this._changes=e}return e}}let r5=(e,t)=>{let r=[];for(;null!==t._item&&t!==e;){if(null!==t._item.parentSub)r.unshift(t._item.parentSub);else{let e=0,s=t._item.parent._start;for(;s!==t._item&&null!==s;)!s.deleted&&s.countable&&(e+=s.length),s=s.right;r.unshift(e)}t=t._item.parent}return r},r7=()=>{tP("Invalid access: Add Yjs type to a document before reading data.")},r9=0;class se{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=r9++}}let st=e=>{e.timestamp=r9++},sr=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=r9++},ss=(e,t,r)=>{if(e.length>=80){let s=e.reduce((e,t)=>e.timestamp<t.timestamp?e:t);return sr(s,t,r),s}{let s=new se(t,r);return e.push(s),s}},sn=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;let r=0===e._searchMarker.length?null:e._searchMarker.reduce((e,r)=>T(t-e.index)<T(t-r.index)?e:r),s=e._start,n=0;for(null!==r&&(s=r.p,n=r.index,st(r));null!==s.right&&n<t;){if(!s.deleted&&s.countable){if(t<n+s.length)break;n+=s.length}s=s.right}for(;null!==s.left&&n>t;)!(s=s.left).deleted&&s.countable&&(n-=s.length);for(;null!==s.left&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)!(s=s.left).deleted&&s.countable&&(n-=s.length);return null!==r&&T(r.index-n)<s.parent.length/80?(sr(r,s,n),r):ss(e._searchMarker,s,n)},si=(e,t,r)=>{for(let s=e.length-1;s>=0;s--){let n=e[s];if(r>0){let t=n.p;for(t.marker=!1;t&&(t.deleted||!t.countable);)(t=t.left)&&!t.deleted&&t.countable&&(n.index-=t.length);if(null===t||!0===t.marker){e.splice(s,1);continue}n.p=t,t.marker=!0}(t<n.index||r>0&&t===n.index)&&(n.index=z(t,n.index+r))}},sl=(e,t,r)=>{let s=e,n=t.changedParentTypes;for(;E(n,e,()=>[]).push(r),null!==e._item;)e=e._item.parent;r_(s._eH,r,t)};class so{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ry(),this._dEH=ry(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw eD()}clone(){throw eD()}_write(e){}get _first(){let e=this._start;for(;null!==e&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){rb(this._eH,e)}observeDeep(e){rb(this._dEH,e)}unobserve(e){rx(this._eH,e)}unobserveDeep(e){rx(this._dEH,e)}toJSON(){}}let sc=(e,t,r)=>{e.doc??r7(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let s=r-t,n=[],i=e._start;for(;null!==i&&s>0;){if(i.countable&&!i.deleted){let e=i.content.getContent();if(e.length<=t)t-=e.length;else{for(let r=t;r<e.length&&s>0;r++)n.push(e[r]),s--;t=0}}i=i.right}return n},sa=e=>{e.doc??r7();let t=[],r=e._start;for(;null!==r;){if(r.countable&&!r.deleted){let e=r.content.getContent();for(let r=0;r<e.length;r++)t.push(e[r])}r=r.right}return t},sh=(e,t)=>{let r=0,s=e._start;for(e.doc??r7();null!==s;){if(s.countable&&!s.deleted){let n=s.content.getContent();for(let s=0;s<n.length;s++)t(n[s],r++,e)}s=s.right}},sd=(e,t)=>{let r=[];return sh(e,(s,n)=>{r.push(t(s,n,e))}),r},su=e=>{let t=e._start,r=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(null===r){for(;null!==t&&t.deleted;)t=t.right;if(null===t)return{done:!0,value:void 0};r=t.content.getContent(),s=0,t=t.right}let e=r[s++];return r.length<=s&&(r=null),{done:!1,value:e}}}},sg=(e,t)=>{e.doc??r7();let r=sn(e,t),s=e._start;for(null!==r&&(s=r.p,t-=r.index);null!==s;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},sf=(e,t,r,s)=>{let n=r,i=e.doc,l=i.clientID,o=i.store,c=null===r?t._start:r.right,a=[],h=()=>{a.length>0&&((n=new nd(rS(l,rI(o,l)),n,n&&n.lastId,c,c&&c.id,t,null,new s9(a))).integrate(e,0),a=[])};s.forEach(r=>{if(null===r)a.push(r);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(r);break;default:switch(h(),r.constructor){case Uint8Array:case ArrayBuffer:(n=new nd(rS(l,rI(o,l)),n,n&&n.lastId,c,c&&c.id,t,null,new s1(new Uint8Array(r)))).integrate(e,0);break;case t1:(n=new nd(rS(l,rI(o,l)),n,n&&n.lastId,c,c&&c.id,t,null,new s8(r))).integrate(e,0);break;default:if(r instanceof so)(n=new nd(rS(l,rI(o,l)),n,n&&n.lastId,c,c&&c.id,t,null,new na(r))).integrate(e,0);else throw Error("Unexpected content type in insert operation")}}}),h()},sp=()=>eC("Length exceeded!"),sw=(e,t,r,s)=>{if(r>t._length)throw sp();if(0===r)return t._searchMarker&&si(t._searchMarker,r,s.length),sf(e,t,null,s);let n=r,i=sn(t,r),l=t._start;for(null!==i&&(l=i.p,0==(r-=i.index)&&(r+=(l=l.prev)&&l.countable&&!l.deleted?l.length:0));null!==l;l=l.right)if(!l.deleted&&l.countable){if(r<=l.length){r<l.length&&rR(e,rS(l.id.client,l.id.clock+r));break}r-=l.length}return t._searchMarker&&si(t._searchMarker,n,s.length),sf(e,t,l,s)},sm=(e,t,r)=>{let s=(t._searchMarker||[]).reduce((e,t)=>t.index>e.index?t:e,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return sf(e,t,s,r)},sy=(e,t,r,s)=>{if(0===s)return;let n=r,i=s,l=sn(t,r),o=t._start;for(null!==l&&(o=l.p,r-=l.index);null!==o&&r>0;o=o.right)!o.deleted&&o.countable&&(r<o.length&&rR(e,rS(o.id.client,o.id.clock+r)),r-=o.length);for(;s>0&&null!==o;)o.deleted||(s<o.length&&rR(e,rS(o.id.client,o.id.clock+s)),o.delete(e),s-=o.length),o=o.right;if(s>0)throw sp();t._searchMarker&&si(t._searchMarker,n,-i+s)},sb=(e,t,r)=>{let s=t._map.get(r);void 0!==s&&s.delete(e)},sx=(e,t,r,s)=>{let n;let i=t._map.get(r)||null,l=e.doc,o=l.clientID;if(null==s)n=new s9([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:n=new s9([s]);break;case Uint8Array:n=new s1(s);break;case t1:n=new s8(s);break;default:if(s instanceof so)n=new na(s);else throw Error("Unexpected content type")}new nd(rS(o,rI(l.store,o)),i,i&&i.lastId,null,null,t,r,n).integrate(e,0)},s_=(e,t)=>{e.doc??r7();let r=e._map.get(t);return void 0===r||r.deleted?void 0:r.content.getContent()[r.length-1]},sk=e=>{let t={};return e.doc??r7(),e._map.forEach((e,r)=>{e.deleted||(t[r]=e.content.getContent()[e.length-1])}),t},sv=(e,t)=>{e.doc??r7();let r=e._map.get(t);return void 0!==r&&!r.deleted},sS=(e,t)=>{let r={};return e._map.forEach((e,s)=>{let n=e;for(;null!==n&&(!t.sv.has(n.id.client)||n.id.clock>=(t.sv.get(n.id.client)||0));)n=n.left;null!==n&&rE(n,t)&&(r[s]=n.content.getContent()[n.length-1])}),r},sC=e=>(e.doc??r7(),tB(e._map.entries(),e=>!e[1].deleted));class sD extends r6{}class sE extends so{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new sE;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sE}clone(){let e=new sE;return e.insert(0,this.toArray().map(e=>e instanceof so?e.clone():e)),e}get length(){return this.doc??r7(),this._length}_callObserver(e,t){super._callObserver(e,t),sl(this,e,new sD(this,e))}insert(e,t){null!==this.doc?rq(this.doc,r=>{sw(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?rq(this.doc,t=>{sm(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?rq(this.doc,r=>{sy(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return sg(this,e)}toArray(){return sa(this)}slice(e=0,t=this.length){return sc(this,e,t)}toJSON(){return this.map(e=>e instanceof so?e.toJSON():e)}map(e){return sd(this,e)}forEach(e){sh(this,e)}[Symbol.iterator](){return su(this)}_write(e){e.writeTypeRef(nr)}}class sN extends r6{constructor(e,t,r){super(e,t),this.keysChanged=r}}class sj extends so{constructor(e){super(),this._prelimContent=null,void 0===e?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((e,t)=>{this.set(t,e)}),this._prelimContent=null}_copy(){return new sj}clone(){let e=new sj;return this.forEach((t,r)=>{e.set(r,t instanceof so?t.clone():t)}),e}_callObserver(e,t){sl(this,e,new sN(this,e,t))}toJSON(){this.doc??r7();let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof so?s.toJSON():s}}),e}get size(){return[...sC(this)].length}keys(){return tF(sC(this),e=>e[0])}values(){return tF(sC(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return tF(sC(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??r7(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?rq(this.doc,t=>{sb(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?rq(this.doc,r=>{sx(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return s_(this,e)}has(e){return sv(this,e)}clear(){null!==this.doc?rq(this.doc,e=>{this.forEach(function(t,r,s){sb(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(ns)}}let sA=(e,t)=>e===t||"object"==typeof e&&"object"==typeof t&&e&&t&&tn(e,t);class sI{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){(null===this.right&&eE(),this.right.content.constructor===s6)?this.right.deleted||sO(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}let sM=(e,t,r)=>{for(;null!==t.right&&r>0;)t.right.content.constructor===s6?t.right.deleted||sO(t.currentAttributes,t.right.content):t.right.deleted||(r<t.right.length&&rR(e,rS(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length),t.left=t.right,t.right=t.right.right;return t},sL=(e,t,r,s)=>{let n=new Map,i=s?sn(t,r):null;return i?sM(e,new sI(i.p.left,i.p,i.index,n),r-i.index):sM(e,new sI(null,t._start,0,n),r)},sU=(e,t,r,s)=>{for(;null!==r.right&&(!0===r.right.deleted||r.right.content.constructor===s6&&sA(s.get(r.right.content.key),r.right.content.value));)r.right.deleted||s.delete(r.right.content.key),r.forward();let n=e.doc,i=n.clientID;s.forEach((s,l)=>{let o=r.left,c=r.right,a=new nd(rS(i,rI(n.store,i)),o,o&&o.lastId,c,c&&c.id,t,null,new s6(l,s));a.integrate(e,0),r.right=a,r.forward()})},sO=(e,t)=>{let{key:r,value:s}=t;null===s?e.delete(r):e.set(r,s)},sR=(e,t)=>{for(;null!==e.right&&(e.right.deleted||e.right.content.constructor===s6&&sA(t[e.right.content.key]??null,e.right.content.value));)e.forward()},sT=(e,t,r,s)=>{let n=e.doc,i=n.clientID,l=new Map;for(let o in s){let c=s[o],a=r.currentAttributes.get(o)??null;if(!sA(a,c)){l.set(o,a);let{left:s,right:h}=r;r.right=new nd(rS(i,rI(n.store,i)),s,s&&s.lastId,h,h&&h.id,t,null,new s6(o,c)),r.right.integrate(e,0),r.forward()}}return l},sP=(e,t,r,s,n)=>{r.currentAttributes.forEach((e,t)=>{void 0===n[t]&&(n[t]=null)});let i=e.doc,l=i.clientID;sR(r,n);let o=sT(e,t,r,n),c=s.constructor===String?new ne(s):s instanceof so?new na(s):new s4(s),{left:a,right:h,index:d}=r;t._searchMarker&&si(t._searchMarker,r.index,c.getLength()),(h=new nd(rS(l,rI(i.store,l)),a,a&&a.lastId,h,h&&h.id,t,null,c)).integrate(e,0),r.right=h,r.index=d,r.forward(),sU(e,t,r,o)},sz=(e,t,r,s,n)=>{let i=e.doc,l=i.clientID;sR(r,n);let o=sT(e,t,r,n);for(;null!==r.right&&(s>0||o.size>0&&(r.right.deleted||r.right.content.constructor===s6));){if(!r.right.deleted){if(r.right.content.constructor===s6){let{key:t,value:i}=r.right.content,l=n[t];if(void 0!==l){if(sA(l,i))o.delete(t);else{if(0===s)break;o.set(t,i)}r.right.delete(e)}else r.currentAttributes.set(t,i)}else s<r.right.length&&rR(e,rS(r.right.id.client,r.right.id.clock+s)),s-=r.right.length}r.forward()}if(s>0){let n="";for(;s>0;s--)n+="\n";r.right=new nd(rS(l,rI(i.store,l)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new ne(n)),r.right.integrate(e,0),r.forward()}sU(e,t,r,o)},sB=(e,t,r,s,n)=>{let i=t,l=C();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===s6){let e=i.content;l.set(e.key,e)}i=i.right}let o=0,c=!1;for(;t!==i;){if(r===t&&(c=!0),!t.deleted){let r=t.content;if(r.constructor===s6){let{key:i,value:a}=r,h=s.get(i)??null;l.get(i)===r&&h!==a||(t.delete(e),o++,c||(n.get(i)??null)!==a||h===a||(null===h?n.delete(i):n.set(i,h))),c||t.deleted||sO(n,r)}}t=t.right}return o},sF=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===s6){let s=t.content.key;r.has(s)?t.delete(e):r.add(s)}t=t.left}},sV=e=>{let t=0;return rq(e.doc,r=>{let s=e._start,n=e._start,i=C(),l=D(i);for(;n;)!1===n.deleted&&(n.content.constructor===s6?sO(l,n.content):(t+=sB(r,s,n,i,l),i=D(l),s=n)),n=n.right}),t},s$=e=>{let t=new Set,r=e.doc;for(let[s,n]of e.afterState.entries()){let i=e.beforeState.get(s)||0;n!==i&&rz(e,r.store.clients.get(s),i,n,e=>{e.deleted||e.content.constructor!==s6||e.constructor===s0||t.add(e.parent)})}rq(r,r=>{for(let s of(tW(e,e.deleteSet,e=>{if(e instanceof s0||!e.parent._hasFormatting||t.has(e.parent))return;let s=e.parent;e.content.constructor===s6?t.add(s):sF(r,e)}),t))sV(s)})},sW=(e,t,r)=>{let s=r,n=D(t.currentAttributes),i=t.right;for(;r>0&&null!==t.right;){if(!1===t.right.deleted)switch(t.right.content.constructor){case na:case s4:case ne:r<t.right.length&&rR(e,rS(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e)}t.forward()}i&&sB(e,i,t.right,n,t.currentAttributes);let l=(t.left||t.right).parent;return l._searchMarker&&si(l._searchMarker,t.index,-s+r),t};class sJ extends r6{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)})}get changes(){if(null===this._changes){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){let e=this.target.doc,t=[];rq(e,e=>{let r=new Map,s=new Map,n=this.target._start,i=null,l={},o="",c=0,a=0,h=()=>{if(null!==i){let e=null;switch(i){case"delete":a>0&&(e={delete:a}),a=0;break;case"insert":("object"==typeof o||o.length>0)&&(e={insert:o},r.size>0&&(e.attributes={},r.forEach((t,r)=>{null!==t&&(e.attributes[r]=t)}))),o="";break;case"retain":c>0&&(e={retain:c},tt(l)||(e.attributes=e6({},l))),c=0}e&&t.push(e),i=null}};for(;null!==n;){switch(n.content.constructor){case na:case s4:this.adds(n)?this.deletes(n)||(h(),i="insert",o=n.content.getContent()[0],h()):this.deletes(n)?("delete"!==i&&(h(),i="delete"),a+=1):n.deleted||("retain"!==i&&(h(),i="retain"),c+=1);break;case ne:this.adds(n)?this.deletes(n)||("insert"!==i&&(h(),i="insert"),o+=n.content.str):this.deletes(n)?("delete"!==i&&(h(),i="delete"),a+=n.length):n.deleted||("retain"!==i&&(h(),i="retain"),c+=n.length);break;case s6:{let{key:t,value:o}=n.content;if(this.adds(n))this.deletes(n)||(sA(r.get(t)??null,o)?null!==o&&n.delete(e):("retain"===i&&h(),sA(o,s.get(t)??null)?delete l[t]:l[t]=o));else if(this.deletes(n)){s.set(t,o);let e=r.get(t)??null;sA(e,o)||("retain"===i&&h(),l[t]=e)}else if(!n.deleted){s.set(t,o);let r=l[t];void 0!==r&&(sA(r,o)?null!==r&&n.delete(e):("retain"===i&&h(),null===o?delete l[t]:l[t]=o))}n.deleted||("insert"===i&&h(),sO(r,n.content))}}n=n.right}for(h();t.length>0;){let e=t[t.length-1];if(void 0!==e.retain&&void 0===e.attributes)t.pop();else break}}),this._delta=t}return this._delta}}class sH extends so{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??r7(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(e=>e())}catch(e){console.error(e)}this._pending=null}_copy(){return new sH}clone(){let e=new sH;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new sJ(this,e,t);sl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??r7();let e="",t=this._start;for(;null!==t;)!t.deleted&&t.countable&&t.content.constructor===ne&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?rq(this.doc,r=>{let s=new sI(null,this._start,0,new Map);for(let n=0;n<e.length;n++){let i=e[n];if(void 0!==i.insert){let l=t||"string"!=typeof i.insert||n!==e.length-1||null!==s.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof l||l.length>0)&&sP(r,this,s,l,i.attributes||{})}else void 0!==i.retain?sz(r,this,s,i.retain,i.attributes||{}):void 0!==i.delete&&sW(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??r7();let s=[],n=new Map,i=this.doc,l="",o=this._start;function c(){if(l.length>0){let e={},t=!1;n.forEach((r,s)=>{t=!0,e[s]=r});let r={insert:l};t&&(r.attributes=e),s.push(r),l=""}}let a=()=>{for(;null!==o;){if(rE(o,e)||void 0!==t&&rE(o,t))switch(o.content.constructor){case ne:{let s=n.get("ychange");void 0===e||rE(o,e)?void 0===t||rE(o,t)?void 0!==s&&(c(),n.delete("ychange")):(void 0===s||s.user!==o.id.client||"added"!==s.type)&&(c(),n.set("ychange",r?r("added",o.id):{type:"added"})):(void 0===s||s.user!==o.id.client||"removed"!==s.type)&&(c(),n.set("ychange",r?r("removed",o.id):{type:"removed"})),l+=o.content.str;break}case na:case s4:{c();let e={insert:o.content.getContent()[0]};if(n.size>0){let t={};e.attributes=t,n.forEach((e,r)=>{t[r]=e})}s.push(e);break}case s6:rE(o,e)&&(c(),sO(n,o.content))}o=o.right}c()};return e||t?rq(i,r=>{e&&rN(r,e),t&&rN(r,t),a()},"cleanup"):a(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;null!==s?rq(s,s=>{let n=sL(s,this,e,!r);r||(r={},n.currentAttributes.forEach((e,t)=>{r[t]=e})),sP(s,this,n,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;null!==s?rq(s,s=>{let n=sL(s,this,e,!r);sP(s,this,n,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(0===t)return;let r=this.doc;null!==r?rq(r,r=>{sW(r,sL(r,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(0===t)return;let s=this.doc;null!==s?rq(s,s=>{let n=sL(s,this,e,!1);null!==n.right&&sz(s,this,n,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){null!==this.doc?rq(this.doc,t=>{sb(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){null!==this.doc?rq(this.doc,r=>{sx(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return s_(this,e)}getAttributes(){return sk(this)}_write(e){e.writeTypeRef(nn)}}class sq{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??r7()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,e.deleted||t.constructor!==sZ&&t.constructor!==sK||null===t._start)for(;null!==e;){let t=e.next;if(null!==t){e=t;break}e=e.parent===this._root?null:e.parent._item}else e=t._start;while(null!==e&&(e.deleted||!this._filter(e.content.type)));return(this._firstCall=!1,null===e)?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class sK extends so{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sK}clone(){let e=new sK;return e.insert(0,this.toArray().map(e=>e instanceof so?e.clone():e)),e}get length(){return this.doc??r7(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new sq(this,e)}querySelector(e){e=e.toUpperCase();let t=new sq(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),M(new sq(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){sl(this,e,new sG(this,t,e))}toString(){return sd(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return void 0!==r&&r._createAssociation(s,this),sh(this,n=>{s.insertBefore(n.toDOM(e,t,r),null)}),s}insert(e,t){null!==this.doc?rq(this.doc,r=>{sw(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)rq(this.doc,r=>{sf(r,this,e&&e instanceof so?e._item:e,t)});else{let r=this._prelimContent,s=null===e?0:r.findIndex(t=>t===e)+1;if(0===s&&null!==e)throw eC("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){null!==this.doc?rq(this.doc,r=>{sy(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return sa(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return sg(this,e)}slice(e=0,t=this.length){return sc(this,e,t)}forEach(e){sh(this,e)}_write(e){e.writeTypeRef(nl)}}class sZ extends sK{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((e,t)=>{this.setAttribute(t,e)}),this._prelimAttrs=null}_copy(){return new sZ(this.nodeName)}clone(){let e=new sZ(this.nodeName);return e7(this.getAttributes(),(t,r)=>{e.setAttribute(r,t)}),e.insert(0,this.toArray().map(e=>e instanceof so?e.clone():e)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let t in e)r.push(t);r.sort();let s=r.length;for(let n=0;n<s;n++){let s=r[n];t.push(s+'="'+e[s]+'"')}let n=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${n}${i}>${super.toString()}</${n}>`}removeAttribute(e){null!==this.doc?rq(this.doc,t=>{sb(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?rq(this.doc,r=>{sx(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return s_(this,e)}hasAttribute(e){return sv(this,e)}getAttributes(e){return e?sS(this,e):sk(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),n=this.getAttributes();for(let e in n){let t=n[e];"string"==typeof t&&s.setAttribute(e,t)}return sh(this,n=>{s.appendChild(n.toDOM(e,t,r))}),void 0!==r&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(ni),e.writeKey(this.nodeName)}}class sG extends r6{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)})}}class sY extends sj{constructor(e){super(),this.hookName=e}_copy(){return new sY(this.hookName)}clone(){let e=new sY(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s;let n=t[this.hookName];return(s=void 0!==n?n.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==r&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(no),e.writeKey(this.hookName)}}class sX extends sH{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new sX}clone(){let e=new sX;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return void 0!==r&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let r in e.attributes){let s=[];for(let t in e.attributes[r])s.push({key:t,value:e.attributes[r][t]});s.sort((e,t)=>e.key<t.key?-1:1),t.push({nodeName:r,attrs:s})}t.sort((e,t)=>e.nodeName<t.nodeName?-1:1);let r="";for(let e=0;e<t.length;e++){let s=t[e];r+=`<${s.nodeName}`;for(let e=0;e<s.attrs.length;e++){let t=s.attrs[e];r+=` ${t.key}="${t.value}"`}r+=">"}r+=e.insert;for(let e=t.length-1;e>=0;e--)r+=`</${t[e].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(nc)}}class sQ{constructor(e,t){this.id=e,this.length=t}get deleted(){throw eD()}mergeWith(e){return!1}write(e,t,r){throw eD()}integrate(e,t){throw eD()}}class s0 extends sQ{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),rM(e.doc.store,this)}write(e,t){e.writeInfo(0),e.writeLen(this.length-t)}getMissing(e,t){return null}}class s1{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new s1(this.content)}splice(e){throw eD()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class s2{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new s2(this.len)}splice(e){let t=new s2(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){tZ(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}let s3=(e,t)=>new t1({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class s8{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new s8(s3(this.doc.guid,this.opts))}splice(e){throw eD()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class s4{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new s4(this.embed)}splice(e){throw eD()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class s6{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new s6(this.key,this.value)}splice(e){throw eD()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}class s5{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new s5(this.arr)}splice(e){let t=new s5(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let t=this.arr[s];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}let s7="development"===tp("node_env");class s9{constructor(e){this.arr=e,s7&&tl(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new s9(this.arr)}splice(e){let t=new s9(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let t=this.arr[s];e.writeAny(t)}}getRef(){return 8}}class ne{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ne(this.str)}splice(e){let t=new ne(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}let nt=[e=>new sE,e=>new sj,e=>new sH,e=>new sZ(e.readKey()),e=>new sK,e=>new sY(e.readKey()),e=>new sX],nr=0,ns=1,nn=2,ni=3,nl=4,no=5,nc=6;class na{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new na(this.type._copy())}splice(e){throw eD()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;null!==t;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(t=>{t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;null!==t;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(t=>{for(;null!==t;)t.gc(e,!0),t=t.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}let nh=(e,t,r)=>{let{client:s,clock:n}=t.id,i=new nd(rS(s,n+r),t,rS(s,n+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),null!==t.redone&&(i.redone=rS(t.redone.client,t.redone.clock+r)),t.right=i,null!==i.right&&(i.right.left=i),e._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),t.length=r,i};class nd extends sQ{constructor(e,t,r,s,n,i,l,o){super(e,o.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=n,this.parent=i,this.parentSub=l,this.redone=null,this.content=o,this.info=this.content.isCountable()?2:0}set marker(e){(8&this.info)>0!==e&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=rI(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=rI(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===rk&&this.id.client!==this.parent.client&&this.parent.clock>=rI(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=rT(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=rR(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===s0||this.right&&this.right.constructor===s0)this.parent=null;else if(this.parent){if(this.parent.constructor===rk){let e=rU(t,this.parent);e.constructor===s0?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===nd?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===nd&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=rT(e,e.doc.store,rS(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,r=this.left;if(null!==r)t=r.right;else if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start;let s=new Set,n=new Set;for(;null!==t&&t!==this.right;){if(n.add(t),s.add(t),rv(this.origin,t.origin)){if(t.id.client<this.id.client)r=t,s.clear();else if(rv(this.rightOrigin,t.rightOrigin))break}else if(null!==t.origin&&n.has(rU(e.doc.store,t.origin)))s.has(rU(e.doc.store,t.origin))||(r=t,s.clear());else break;t=t.right}this.left=r}if(null!==this.left){let e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),rM(e.doc.store,this),this.content.integrate(e,this),rV(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new s0(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;null!==e&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;null!==e&&e.deleted;)e=e.left;return e}get lastId(){return 1===this.length?this.id:rS(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&rv(e.origin,this.lastId)&&this.right===e&&rv(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),tZ(e.deleteSet,this.id.client,this.id.clock,this.length),rV(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw eE();this.content.gc(e),t?rP(e,this,new s0(this.id,this.length)):this.content=new s2(this.length)}write(e,t){let r=t>0?rS(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,n=this.parentSub,i=31&this.content.getRef()|(null===r?0:128)|(null===s?0:64)|(null===n?0:32);if(e.writeInfo(i),null!==r&&e.writeLeftID(r),null!==s&&e.writeRightID(s),null===r&&null===s){let t=this.parent;if(void 0!==t._item){let r=t._item;if(null===r){let r=rC(t);e.writeParentInfo(!0),e.writeString(r)}else e.writeParentInfo(!1),e.writeLeftID(r.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===rk?(e.writeParentInfo(!1),e.writeLeftID(t)):eE();null!==n&&e.writeString(n)}this.content.write(e,t)}}let nu=(e,t)=>ng[31&t](e),ng=[()=>{eE()},e=>new s2(e.readLen()),e=>{let t=e.readLen(),r=[];for(let s=0;s<t;s++){let t=e.readString();"undefined"===t?r.push(void 0):r.push(JSON.parse(t))}return new s5(r)},e=>new s1(e.readBuf()),e=>new ne(e.readString()),e=>new s4(e.readJSON()),e=>new s6(e.readKey(),e.readJSON()),e=>new na(nt[e.readTypeRef()](e)),e=>{let t=e.readLen(),r=[];for(let s=0;s<t;s++)r.push(e.readAny());return new s9(r)},e=>new s8(s3(e.readString(),e.readAny())),()=>{eE()}];class nf extends sQ{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){eE()}write(e,t){e.writeInfo(10),ei(e.restEncoder,this.length-t)}getMissing(e,t){return null}}let np="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},nw="__ $YJS$ __";!0===np[nw]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),np[nw]=!0;let nm=e=>eG((t,r)=>{e.onerror=e=>r(Error(e.target.error)),e.onsuccess=e=>t(e.target.result)}),ny=(e,t)=>eG((r,s)=>{let n=indexedDB.open(e);n.onupgradeneeded=e=>t(e.target.result),n.onerror=e=>s(eC(e.target.error)),n.onsuccess=e=>{let t=e.target.result;t.onversionchange=()=>{t.close()},r(t)}}),nb=e=>nm(indexedDB.deleteDatabase(e)),nx=(e,t)=>t.forEach(t=>e.createObjectStore.apply(e,t)),n_=(e,t,r="readwrite")=>{let s=e.transaction(t,r);return t.map(e=>nM(s,e))},nk=(e,t)=>nm(e.count(t)),nv=(e,t)=>nm(e.get(t)),nS=(e,t)=>nm(e.delete(t)),nC=(e,t,r)=>nm(e.put(t,r)),nD=(e,t)=>nm(e.add(t)),nE=(e,t,r)=>nm(e.getAll(t,r)),nN=(e,t,r)=>{let s=null;return nI(e,t,e=>(s=e,!1),r).then(()=>s)},nj=(e,t=null)=>nN(e,t,"prev"),nA=(e,t)=>eG((r,s)=>{e.onerror=s,e.onsuccess=async e=>{let s=e.target.result;if(null===s||await t(s)===!1)return r();s.continue()}}),nI=(e,t,r,s="next")=>nA(e.openKeyCursor(t,s),e=>r(e.key)),nM=(e,t)=>e.objectStore(t),nL=(e,t)=>IDBKeyRange.upperBound(e,t),nU=(e,t)=>IDBKeyRange.lowerBound(e,t),nO="custom",nR="updates",nT=(e,t=()=>{},r=()=>{})=>{let[s]=n_(e.db,[nR]);return nE(s,nU(e._dbref,!1)).then(n=>{e._destroyed||(t(s),rq(e.doc,()=>{n.forEach(t=>ro(e.doc,t))},e,!1),r(s))}).then(()=>nj(s).then(t=>{e._dbref=t+1})).then(()=>nk(s).then(t=>{e._dbsize=t})).then(()=>s)},nP=(e,t=!0)=>nT(e).then(r=>{(t||e._dbsize>=500)&&nD(r,rh(e.doc)).then(()=>nS(r,nL(e._dbref,!0))).then(()=>nk(r).then(t=>{e._dbsize=t}))});class nz extends O{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=ny(e,e=>nx(e,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=eG(e=>this.on("synced",()=>e(this))),this._db.then(e=>{this.db=e,nT(this,e=>nD(e,rh(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(e,t)=>{if(this.db&&t!==this){let[t]=n_(this.db,[nR]);nD(t,e),++this._dbsize>=500&&(null!==this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{nP(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{nb(this.name)})}get(e){return this._db.then(t=>{let[r]=n_(t,[nO],"readonly");return nv(r,e)})}set(e,t){return this._db.then(r=>{let[s]=n_(r,[nO]);return nC(s,t,e)})}del(e){return this._db.then(t=>{let[r]=n_(t,[nO]);return nS(r,e)})}}let nB=new Map;class nF{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:tk(t.newValue||"")}),e2(this._onChange)}postMessage(e){e1.setItem(this.room,t_(tx(e)))}close(){e3(this._onChange)}}let nV="undefined"==typeof BroadcastChannel?nF:BroadcastChannel,n$=e=>E(nB,e,()=>{let t=j(),r=new nV(e);return r.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:r,subs:t}}),nW=(e,t)=>(n$(e).subs.add(t),t),nJ=(e,t)=>{let r=n$(e),s=r.subs.delete(t);return s&&0===r.subs.size&&(r.bc.close(),nB.delete(e)),s},nH=(e,t,r=null)=>{let s=n$(e);s.bc.postMessage(t),s.subs.forEach(e=>e(t,r))},nq=(e,t)=>{ei(e,0),ed(e,rw(t))},nK=(e,t,r)=>{ei(e,1),ed(e,rh(t,r))},nZ=(e,t,r)=>nK(t,r,eU(e)),nG=(e,t,r,s)=>{try{ro(t,eU(e),r)}catch(e){null!=s&&s(e),console.error("Caught error while handling a Yjs update",e)}},nY=(e,t)=>{ei(e,2),ed(e,t)},nX=(e,t,r,s,n)=>{let i=eR(e);switch(i){case 0:nZ(e,t,r);break;case 1:case 2:nG(e,r,s,n);break;default:throw Error("Unknown message type")}return i},nQ=(e,t,r)=>{0===eR(e)&&r(t,eP(e))};class n0 extends O{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let e=tC();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let t=[];this.meta.forEach((r,s)=>{s!==this.clientID&&3e4<=e-r.lastUpdated&&this.states.has(s)&&t.push(s)}),t.length>0&&n1(this,t,"timeout")},R(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=void 0===r?0:r.clock+1,n=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:tC()});let i=[],l=[],o=[],c=[];null===e?c.push(t):null==n?null!=e&&i.push(t):(l.push(t),ta(n,e)||o.push(t)),(i.length>0||o.length>0||c.length>0)&&this.emit("change",[{added:i,updated:o,removed:c},"local"]),this.emit("update",[{added:i,updated:l,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();null!==r&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}let n1=(e,t,r)=>{let s=[];for(let r=0;r<t.length;r++){let n=t[r];if(e.states.has(n)){if(e.states.delete(n),n===e.clientID){let t=e.meta.get(n);e.meta.set(n,{clock:t.clock+1,lastUpdated:tC()})}s.push(n)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},r]),e.emit("update",[{added:[],updated:[],removed:s},r]))},n2=(e,t,r=e.states)=>{let s=t.length,n=ee();ei(n,s);for(let i=0;i<s;i++){let s=t[i],l=r.get(s)||null,o=e.meta.get(s).clock;ei(n,s),ei(n,o),ea(n,JSON.stringify(l))}return er(n)},n3=(e,t,r)=>{let s=eI(t),n=tC(),i=[],l=[],o=[],c=[],a=eR(s);for(let t=0;t<a;t++){let t=eR(s),r=eR(s),a=JSON.parse(eP(s)),h=e.meta.get(t),d=e.states.get(t),u=void 0===h?0:h.clock;(u<r||u===r&&null===a&&e.states.has(t))&&(null===a?t===e.clientID&&null!=e.getLocalState()?r++:e.states.delete(t):e.states.set(t,a),e.meta.set(t,{clock:r,lastUpdated:n}),void 0===h&&null!==a?i.push(t):void 0!==h&&null===a?c.push(t):null!==a&&(ta(a,d)||o.push(t),l.push(t)))}(i.length>0||o.length>0||c.length>0)&&e.emit("change",[{added:i,updated:o,removed:c},r]),(i.length>0||l.length>0||c.length>0)&&e.emit("update",[{added:i,updated:l,removed:c},r])},n8=e=>e9(e,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),n4=[];n4[0]=(e,t,r,s,n)=>{ei(e,0);let i=nX(t,e,r.doc,r);s&&1===i&&!r.synced&&(r.synced=!0)},n4[3]=(e,t,r,s,n)=>{ei(e,1),ed(e,n2(r.awareness,Array.from(r.awareness.getStates().keys())))},n4[1]=(e,t,r,s,n)=>{n3(r.awareness,eU(t),r)},n4[2]=(e,t,r,s,n)=>{nQ(t,r.doc,(e,t)=>n6(r,t))};let n6=(e,t)=>console.warn(`Permission denied to access ${e.url}.
${t}`),n5=(e,t,r)=>{let s=eI(t),n=ee(),i=eR(s),l=e.messageHandlers[i];return l?l(n,s,e,r,i):console.error("Unable to compute message"),n},n7=(e,t,r)=>{t===e.ws&&(e.emit("connection-close",[r,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,n1(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(n9,P(100*B(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e))},n9=e=>{if(e.shouldConnect&&null===e.ws){let t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=r=>{e.wsLastMessageReceived=tC();let s=n5(e,new Uint8Array(r.data),!0);et(s)>1&&t.send(er(s))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=r=>{n7(e,t,r)},t.onopen=()=>{e.wsLastMessageReceived=tC(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);let r=ee();if(ei(r,0),nq(r,e.doc),t.send(er(r)),null!==e.awareness.getLocalState()){let r=ee();ei(r,1),ed(r,n2(e.awareness,[e.doc.clientID])),t.send(er(r))}},e.emit("status",[{status:"connecting"}])}},ie=(e,t)=>{let r=e.ws;e.wsconnected&&r&&r.readyState===r.OPEN&&r.send(t),e.bcconnected&&nH(e.bcChannel,t,e)};class it extends U{constructor(e,t,r,{connect:s=!0,awareness:n=new n0(r),params:i={},protocols:l=[],WebSocketPolyfill:o=WebSocket,resyncInterval:c=-1,maxBackoffTime:a=2500,disableBc:h=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=a,this.params=i,this.protocols=l,this.roomname=t,this.doc=r,this._WS=o,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=h,this.wsUnsuccessfulReconnects=0,this.messageHandlers=n4.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let e=ee();ei(e,0),nq(e,r),this.ws.send(er(e))}},c)),this._bcSubscriber=(e,t)=>{if(t!==this){let t=n5(this,new Uint8Array(e),!1);et(t)>1&&nH(this.bcChannel,er(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){let t=ee();ei(t,0),nY(t,e),ie(this,er(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:r},s)=>{let i=e.concat(t).concat(r),l=ee();ei(l,1),ed(l,n2(n,i)),ie(this,er(l))},this._exitHandler=()=>{n1(this.awareness,[r.clientID],"app closed")},th&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<tC()-this.wsLastMessageReceived&&n7(this,this.ws,null)},3e3),s&&this.connect()}get url(){let e=n8(this.params);return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),th&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(nW(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let e=ee();ei(e,0),nq(e,this.doc),nH(this.bcChannel,er(e),this);let t=ee();ei(t,0),nK(t,this.doc),nH(this.bcChannel,er(t),this);let r=ee();ei(r,3),nH(this.bcChannel,er(r),this);let s=ee();ei(s,1),ed(s,n2(this.awareness,[this.doc.clientID])),nH(this.bcChannel,er(s),this)}disconnectBc(){let e=ee();ei(e,1),ed(e,n2(this.awareness,[this.doc.clientID],new Map)),ie(this,er(e)),this.bcconnected&&(nJ(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&n7(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(n9(this),this.connectBc())}}let ir={wsUrl:"ws://localhost:3001",reconnectInterval:5e3,maxReconnectAttempts:10};class is{async initialize(e,t,r){try{if(this.ydoc){console.warn("[Sync] Already initialized");return}console.log("[Sync] Initializing for user:",e,"with token:",t),this.userId=e,this.token=t;let s=r||`user-${e}`;this.ydoc=new t1,this.idbProvider=new nz(`memovault-${s}`,this.ydoc),await new Promise(e=>{this.idbProvider.on("synced",()=>{console.log("[Sync] IndexedDB synced"),e()}),this.idbProvider.on("sync",()=>{console.log("[Sync] IndexedDB syncing...")}),setTimeout(()=>{this.idbProvider?.synced||(console.warn("[Sync] IndexedDB sync timeout, continuing..."),e())},5e3)});let n=ir.wsUrl;this.wsProvider=new it(n,s,this.ydoc,{connect:!0,params:{token,userId}}),this.wsProvider.on("status",e=>{switch(console.log("[Sync] WebSocket status:",e.status),e.status){case"connected":this.updateState({status:"synced",lastSyncAt:new Date,pendingChanges:0}),this.reconnectAttempts=0,this.clearReconnectTimer();break;case"connecting":this.updateState({status:"syncing"});break;case"disconnected":this.updateState({status:"idle"}),this.scheduleReconnect()}}),this.wsProvider.on("connection-error",e=>{console.error("[Sync] WebSocket connection error:",e),this.updateState({status:"error",errorMessage:e.message})}),this.ydoc.on("update",(e,t)=>{(!t||t===this.wsProvider?.awareness.clientID)&&this.state.pendingChanges++}),console.log("[Sync] Initialized successfully")}catch(e){throw console.error("[Sync] Initialization error:",e),Error("Failed to initialize sync engine")}}async disconnect(){try{this.clearReconnectTimer(),this.wsProvider&&(this.wsProvider.disconnect(),this.wsProvider.destroy(),this.wsProvider=null),this.idbProvider&&(await this.idbProvider.destroy(),this.idbProvider=null),this.ydoc&&(this.ydoc.destroy(),this.ydoc=null),this.userId=null,this.token=null,this.updateState({status:"idle",pendingChanges:0}),console.log("[Sync] Disconnected")}catch(e){throw console.error("[Sync] Disconnect error:",e),Error("Failed to disconnect sync engine")}}getDoc(){return this.ydoc}getState(){return{...this.state}}onStateChange(e){return this.stateChangeListeners.add(e),()=>{this.stateChangeListeners.delete(e)}}async forceSync(){try{if(!this.wsProvider||!this.wsProvider.wsconnected)throw Error("WebSocket not connected");this.updateState({status:"syncing"}),await new Promise(e=>{let t=setTimeout(()=>e(),2e3);this.wsProvider.on("sync",()=>{clearTimeout(t),e()})}),this.updateState({status:"synced",lastSyncAt:new Date,pendingChanges:0}),console.log("[Sync] Force sync completed")}catch(e){throw console.error("[Sync] Force sync error:",e),this.updateState({status:"error",errorMessage:e instanceof Error?e.message:"Unknown error"}),e}}getNotesData(){return this.ydoc?this.ydoc.getMap("notes"):null}getFilesData(){return this.ydoc?this.ydoc.getMap("files"):null}saveNote(e,t){if(!this.ydoc)throw Error("Sync engine not initialized");this.ydoc.getMap("notes").set(e,t),console.log(`[Sync] Saved note: ${e}`)}deleteNote(e){if(!this.ydoc)throw Error("Sync engine not initialized");this.ydoc.getMap("notes").delete(e),console.log(`[Sync] Deleted note: ${e}`)}saveFile(e,t){if(!this.ydoc)throw Error("Sync engine not initialized");this.ydoc.getMap("files").set(e,t),console.log(`[Sync] Saved file: ${e}`)}deleteFile(e){if(!this.ydoc)throw Error("Sync engine not initialized");this.ydoc.getMap("files").delete(e),console.log(`[Sync] Deleted file: ${e}`)}getOnlineUsers(){return this.wsProvider?Array.from(this.wsProvider.awareness.getStates().values()):[]}setUserState(e){this.wsProvider&&this.wsProvider.awareness.setLocalStateField("user",e)}updateState(e){this.state={...this.state,...e},this.stateChangeListeners.forEach(e=>{e(this.state)})}scheduleReconnect(){if(this.reconnectAttempts>=ir.maxReconnectAttempts){console.error("[Sync] Max reconnect attempts reached"),this.updateState({status:"error",errorMessage:"Max reconnect attempts reached"});return}this.clearReconnectTimer(),this.reconnectTimer=setTimeout(()=>{this.reconnectAttempts++,console.log(`[Sync] Reconnecting... (attempt ${this.reconnectAttempts})`),this.wsProvider&&this.wsProvider.connect()},ir.reconnectInterval)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}constructor(){this.ydoc=null,this.wsProvider=null,this.idbProvider=null,this.userId=null,this.token=null,this.state={status:"idle",pendingChanges:0},this.reconnectAttempts=0,this.reconnectTimer=null,this.stateChangeListeners=new Set}}let ii=new is;function il({notes:e,selectedNoteId:t,onNoteSelect:r,onNewNote:s,onNoteDelete:i,isOpen:l,onToggle:c,onNavigateToGraph:g}){return(0,n.jsxs)("aside",{className:`
        fixed left-0 top-0 h-full bg-slate-900 text-white
        transition-all duration-300 ease-in-out z-40
        ${l?"w-72":"w-0 overflow-hidden"}
        lg:relative lg:translate-x-0
      `,children:[(0,n.jsxs)("div",{className:"p-4 border-b border-slate-700",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h1",{className:"text-xl font-bold flex items-center gap-2",children:[n.jsx(o.Z,{className:"w-6 h-6"}),"MemoVault"]}),n.jsx("button",{onClick:c,className:"lg:hidden p-2 hover:bg-slate-800 rounded-lg",children:n.jsx(a,{className:"w-5 h-5"})})]}),(0,n.jsxs)("button",{onClick:()=>s(),className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors",children:[n.jsx(h,{className:"w-4 h-4"}),""]})]}),(0,n.jsxs)("nav",{className:"p-4",children:[(0,n.jsxs)("button",{onClick:g,className:"w-full flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg transition-colors mb-2",children:[n.jsx(d,{className:"w-5 h-5"}),""]}),(0,n.jsxs)("button",{className:"w-full flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg transition-colors mb-2",children:[n.jsx(u,{className:"w-5 h-5"}),""]})]}),(0,n.jsxs)("div",{className:"p-4 border-t border-slate-700 overflow-y-auto flex-1",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-400 mb-3",children:""}),n.jsx("ul",{className:"space-y-1",children:0===e.length?n.jsx("li",{className:"text-slate-500 text-sm text-center py-4",children:""}):e.map(e=>n.jsx("li",{children:(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("button",{onClick:()=>r(e.id),className:`
                      flex-1 text-left p-3 rounded-lg transition-colors
                      ${t===e.id?"bg-blue-600 text-white":"hover:bg-slate-800"}
                    `,children:[n.jsx("div",{className:"font-medium truncate",children:e.title}),n.jsx("div",{className:"text-xs text-slate-400 mt-1",children:new Date(e.updatedAt).toLocaleDateString("zh-CN")})]}),n.jsx("button",{onClick:()=>i(e.id),className:"p-2 hover:bg-red-600 rounded-lg transition-colors text-slate-400 hover:text-white",title:"",children:n.jsx(a,{className:"w-4 h-4"})})]})},e.id))})]})]})}function io({onToggleSidebar:e,onOpenSearch:t,onOpenSettings:r,syncState:s,onLogout:i}){return(0,n.jsxs)("header",{className:"bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between sticky top-0 z-30",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:e,className:"lg:hidden p-2 hover:bg-slate-100 rounded-lg",children:n.jsx(g,{className:"w-6 h-6"})}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:["synced"===s.status&&(0,n.jsxs)(n.Fragment,{children:[n.jsx(f,{className:"w-4 h-4 text-green-500"}),n.jsx("span",{className:"text-slate-600",children:""})]}),"syncing"===s.status&&(0,n.jsxs)(n.Fragment,{children:[n.jsx(p,{className:"w-4 h-4 text-blue-500 animate-spin"}),n.jsx("span",{className:"text-slate-600",children:"..."})]}),"error"===s.status&&(0,n.jsxs)(n.Fragment,{children:[n.jsx(w,{className:"w-4 h-4 text-red-500"}),n.jsx("span",{className:"text-slate-600",children:""})]}),"idle"===s.status&&n.jsx(n.Fragment,{children:n.jsx("span",{className:"text-slate-400",children:"WebSocket "})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:[n.jsx(m,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm text-slate-600 hidden sm:inline",children:" (Ctrl+K)"})]}),(0,n.jsxs)("button",{onClick:r,className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:[n.jsx(u,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm text-slate-600 hidden sm:inline",children:""})]}),n.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"",children:n.jsx(y,{className:"w-5 h-5 text-slate-600"})})]})]})}function ic({selectedNote:e,onNoteChange:t,onSave:r}){let[s,l]=(0,i.useState)("");return e?(0,n.jsxs)("main",{className:"flex-1 flex flex-col bg-white",children:[n.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:n.jsx("input",{type:"text",value:e.title,onChange:e=>t({title:e.target.value}),className:"w-full text-2xl font-bold bg-transparent border-none outline-none placeholder-slate-400",placeholder:"..."})}),n.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:n.jsx("textarea",{value:s,onChange:e=>{l(e.target.value),t({content:e.target.value})},onBlur:r,className:"w-full h-full resize-none bg-transparent border-none outline-none text-slate-700 leading-relaxed placeholder-slate-400",placeholder:"...",style:{minHeight:"calc(100vh - 300px)"}})}),(0,n.jsxs)("div",{className:"border-t border-slate-200 px-6 py-3 flex items-center justify-between text-sm text-slate-500",children:[(0,n.jsxs)("div",{children:[": ",new Date(e.updatedAt).toLocaleString("zh-CN")]}),n.jsx("div",{children:" [[WikiLink]] "})]})]}):n.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-50",children:(0,n.jsxs)("div",{className:"text-center text-slate-500",children:[n.jsx(o.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{className:"text-lg",children:""})]})})}function ia({selectedNoteId:e,onNoteSelect:t,onNewNote:r,onLogout:s}){var l;let[o,c]=(0,i.useState)(!0),[h,d]=(0,i.useState)(!1),[u,g]=(0,i.useState)(!1),[f,p]=(0,i.useState)(""),w=(l=()=>x(),function(e,t,r){"function"==typeof e?(s=t||[],n=r):(s=[],n=t);var s,n,l=i.useRef({hasResult:!1,result:n,error:null}),o=i.useReducer(function(e){return e+1},0);o[0];var c=o[1],a=i.useMemo(function(){var t="function"==typeof e?e():e;if(!t||"function"!=typeof t.subscribe){if(e===t)throw TypeError("Given argument to useObservable() was neither a valid observable nor a function.");throw TypeError("Observable factory given to useObservable() did not return a valid observable.")}if(!l.current.hasResult&&"undefined"!=typeof window&&("function"!=typeof t.hasValue||t.hasValue())){if("function"==typeof t.getValue)l.current.result=t.getValue(),l.current.hasResult=!0;else{var r=t.subscribe(function(e){l.current.result=e,l.current.hasResult=!0});"function"==typeof r?r():r.unsubscribe()}}return t},s);if(i.useDebugValue(l.current.result),i.useEffect(function(){var e=a.subscribe(function(e){var t=l.current;(null!==t.error||t.result!==e)&&(t.error=null,t.result=e,t.hasResult=!0,c())},function(e){var t=l.current;t.error!==e&&(t.error=e,c())});return"function"==typeof e?e:e.unsubscribe.bind(e)},s),l.current.error)throw l.current.error;return l.current.result}(function(){return(0,b.Y1)(l)},[],[])),y=function(){let[e,t]=(0,i.useState)(ii.getState());return e}(),_=(0,i.useMemo)(()=>{if(!f)return[];let e=f.toLowerCase();return w.filter(t=>t.title.toLowerCase().includes(e)||t.content.toLowerCase().includes(e))},[w,f]),S=w.find(t=>t.id===e),C=async()=>{await r(),window.innerWidth<1024&&c(!1)},D=()=>{d(!1),p("")},E=e=>{t(e),D()},N=async e=>{if(S)try{await k(S.id,e),console.log("Note updated:",e)}catch(e){console.error("Error updating note:",e),alert("")}},j=async r=>{if(confirm(""))try{await v(r),e===r&&t("")}catch(e){console.error("Error deleting note:",e),alert("")}};return(0,n.jsxs)("div",{className:"flex h-screen bg-slate-100 overflow-hidden",children:[n.jsx(il,{notes:w,selectedNoteId:e,onNoteSelect:e=>{t(e),window.innerWidth<1024&&c(!1)},onNewNote:C,onNoteDelete:j,isOpen:o,onToggle:()=>c(!o),onNavigateToGraph:()=>{console.log("Navigating to graph...")}}),o&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>c(!1)}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsx(io,{onToggleSidebar:()=>c(!o),onOpenSearch:()=>{d(!0),p("")},onOpenSettings:()=>{g(!0)},syncState:y,onLogout:s}),n.jsx(ic,{selectedNote:S,onNoteChange:N,onSave:()=>{console.log("Note saved")}})]}),h&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[n.jsx("h2",{className:"text-2xl font-bold",children:""}),n.jsx("button",{onClick:D,className:"p-2 hover:bg-slate-100 rounded-lg",children:n.jsx(a,{className:"w-6 h-6"})})]}),n.jsx("div",{className:"p-6",children:n.jsx("input",{type:"text",value:f,onChange:e=>{p(e.target.value)},placeholder:"...",className:"w-full px-4 py-3 border border-slate-300 rounded-lg text-lg outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_&&0===_.length?(0,n.jsxs)("div",{className:"text-center text-slate-500 py-8",children:[n.jsx(m,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:""})]}):_&&_.length>0?n.jsx("ul",{className:"space-y-2",children:_.map(e=>n.jsx("li",{children:(0,n.jsxs)("button",{onClick:()=>E(e.id),className:"w-full text-left p-4 rounded-lg hover:bg-slate-100 transition-colors",children:[n.jsx("div",{className:"font-semibold text-lg",children:e.title}),n.jsx("div",{className:"text-sm text-slate-500 mt-1 line-clamp-2",children:e.content||""})]})},e.id))}):null})]})}),u&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[n.jsx("h2",{className:"text-2xl font-bold",children:""}),n.jsx("button",{onClick:()=>{g(!1)},className:"p-2 hover:bg-slate-100 rounded-lg",children:n.jsx(a,{className:"w-6 h-6"})})]}),(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[n.jsx("h3",{className:"font-semibold text-lg",children:""}),n.jsx("p",{className:"text-sm text-slate-500",children:localStorage.getItem("email")})]}),n.jsx("button",{onClick:s,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:""})]}),(0,n.jsxs)("div",{children:[n.jsx("h3",{className:"font-semibold text-lg mb-2",children:""}),(0,n.jsxs)("div",{className:"space-y-2 text-sm text-slate-600",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[n.jsx("span",{children:""}),n.jsx("span",{className:"font-medium",children:"0.1.0"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[n.jsx("span",{children:""}),n.jsx("span",{className:"font-medium",children:" IndexedDB"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[n.jsx("span",{children:""}),n.jsx("span",{className:"font-medium",children:"PBKDF2 + AES-GCM-256"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[n.jsx("span",{children:""}),n.jsx("span",{className:`font-medium ${"synced"===y.status?"text-green-600":"syncing"===y.status?"text-blue-600":"error"===y.status?"text-red-600":"text-slate-400"}`,children:"synced"===y.status?"":"syncing"===y.status?"...":"error"===y.status?"":""})]})]})]}),n.jsx("div",{className:"border-t border-slate-200 pt-6",children:n.jsx("p",{className:"text-xs text-slate-400 text-center",children:"MemoVault - "})})]})]})})]})}function ih(){let e=(0,l.useRouter)(),[t,r]=(0,i.useState)(null),[s,o]=(0,i.useState)(!1),c=async()=>{try{let e=await _({title:"",content:"",tags:[],isDeleted:!1,wikiLinks:[]});r(e.id)}catch(e){console.error("Error creating note:",e),alert("")}},a=async()=>{await ii.disconnect(),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("email"),localStorage.removeItem("salt"),e.push("/")};return s?n.jsx(ia,{selectedNoteId:t,onNoteSelect:r,onNewNote:c,onLogout:a}):n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-600",children:"..."})]})})}},3023:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\admin\Desktop\bianqian\src\app\app\page.tsx#default`)},2029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,metadata:()=>n,viewport:()=>i});var s=r(9510);r(5023);let n={title:"MemoVault - ",description:"",keywords:["","","","","Local-First"],authors:[{name:"MemoVault Team"}],manifest:"/manifest.json",icons:{icon:"/favicon.ico",apple:"/apple-touch-icon.png"}},i={width:"device-width",initialScale:1,themeColor:"#3b82f6"};function l({children:e}){return(0,s.jsxs)("html",{lang:"zh-CN",children:[s.jsx("head",{children:s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})}),s.jsx("body",{className:"antialiased",children:e})]})}},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,471,481],()=>r(1010));module.exports=s})();