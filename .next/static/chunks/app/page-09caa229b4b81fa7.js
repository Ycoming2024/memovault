(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5536:function(e,t,s){Promise.resolve().then(s.bind(s,7474))},7474:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var r=s(7437),a=s(2265),l=s(6463),i=s(2023),n=s(8030);let c=(0,n.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),o=(0,n.Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),d=(0,n.Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),u={iterations:6e5,hash:"SHA-256"};async function m(e,t){try{var s;let r=new TextEncoder().encode(e),a=await crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t.buffer,iterations:u.iterations,hash:u.hash},a,256);return s=new Uint8Array(l),Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){throw console.error("[Crypto] Error deriving auth hash:",e),Error("Failed to derive auth hash")}}class h{setMasterKey(e){this.masterKey=e}getMasterKey(){return this.masterKey}setPrivateKey(e){this.privateKey=e}getPrivateKey(){return this.privateKey}clear(){this.masterKey=null,this.privateKey=null}isInitialized(){return null!==this.masterKey}constructor(){this.masterKey=null,this.privateKey=null}}new h;var x=s(4635);class p extends x.ZP{constructor(){super("MemoVaultUsers"),this.version(1).stores({users:"email, userId, createdAt"})}}let y=new p,f={exists:async e=>!!await y.users.where("email").equals(e).first(),async create(e,t,s){let r=crypto.randomUUID(),a={email:e,authHash:t,salt:Array.from(s),userId:r,createdAt:new Date},l=await y.users.add(a);return{...a,id:l}},get:async e=>await y.users.where("email").equals(e).first(),async verifyPassword(e,t){let s=await this.get(e);return!!s&&s.authHash===t},async delete(e){await y.users.where("email").equals(e).delete()},getAll:async()=>await y.users.toArray()};async function b(e,t){try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{success:!1,error:{code:"INVALID_EMAIL",message:"邮箱格式不正确"}};if(t.length<8)return{success:!1,error:{code:"WEAK_PASSWORD",message:"密码至少需要 8 个字符"}};if(await f.exists(e))return{success:!1,error:{code:"EMAIL_EXISTS",message:"该邮箱已被注册"}};let s=crypto.getRandomValues(new Uint8Array(32)),r=await m(t,s),a=await f.create(e,r,s),l=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,userId:a.userId})}),i=await l.json();if(!i.success)return{success:!1,error:i.error};return{success:!0,data:{token:i.data.token,userId:a.userId,email:a.email,salt:a.salt}}}catch(e){return console.error("[AuthService] Register error:",e),{success:!1,error:{code:"INTERNAL_ERROR",message:"注册失败，请稍后重试"}}}}async function g(e,t){try{let s=await f.get(e);if(!s)return{success:!1,error:{code:"USER_NOT_FOUND",message:"用户不存在，请先注册"}};let r=new Uint8Array(s.salt),a=await m(t,r);if(s.authHash!==a)return{success:!1,error:{code:"INVALID_PASSWORD",message:"密码错误"}};let l=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,userId:s.userId})}),i=await l.json();if(!i.success)return{success:!1,error:i.error};return{success:!0,data:{token:i.data.token,userId:s.userId,email:s.email,salt:s.salt}}}catch(e){return console.error("[AuthService] Login error:",e),{success:!1,error:{code:"INTERNAL_ERROR",message:"登录失败，请稍后重试"}}}}function w(){let e=(0,l.useRouter)(),[t,s]=(0,a.useState)(""),[n,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[x,p]=(0,a.useState)(""),[y,f]=(0,a.useState)(!1),w=async s=>{s.preventDefault(),h(!0),p("");try{let s=y?await b(t,n):await g(t,n);if(s.success&&s.data)localStorage.setItem("token",s.data.token),localStorage.setItem("userId",s.data.userId),localStorage.setItem("email",s.data.email),localStorage.setItem("salt",JSON.stringify(s.data.salt)),e.push("/app");else{var r;p((null===(r=s.error)||void 0===r?void 0:r.message)||"操作失败")}}catch(e){console.error("Auth error:",e),p("网络错误，请稍后重试")}finally{h(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-4xl w-full",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,r.jsx)(i.Z,{className:"w-16 h-16 text-blue-600"})}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:"MemoVault"}),(0,r.jsx)("p",{className:"text-lg text-slate-600",children:"隐私优先的个人知识库"})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[(0,r.jsx)(v,{icon:(0,r.jsx)(c,{className:"w-8 h-8"}),title:"端到端加密",description:"所有数据在本地加密，服务器零知悉"}),(0,r.jsx)(v,{icon:(0,r.jsx)(o,{className:"w-8 h-8"}),title:"本地优先",description:"数据存储在本地，离线也能使用"}),(0,r.jsx)(v,{icon:(0,r.jsx)(d,{className:"w-8 h-8"}),title:"实时同步",description:"使用 CRDT 技术，多端无缝同步"})]}),(0,r.jsx)("div",{className:"max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 text-center",children:y?"创建账号":"欢迎回来"}),(0,r.jsx)("button",{type:"button",onClick:()=>{f(!y),p("")},className:"text-sm text-blue-600 hover:text-blue-700",children:y?"已有账号？登录":"没有账号？注册"})]}),x&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-4",children:x}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 mb-2",children:"邮箱"}),(0,r.jsx)("input",{id:"email",type:"email",value:t,onChange:e=>s(e.target.value),required:!0,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",placeholder:"your@email.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700 mb-2",children:"密码"}),(0,r.jsx)("input",{id:"password",type:"password",value:n,onChange:e=>u(e.target.value),required:!0,minLength:8,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",placeholder:"••••••••"}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"密码至少需要 8 个字符"})]}),(0,r.jsx)("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:m?y?"注册中...":"登录中...":y?"注册":"登录"})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("a",{href:"#",className:"text-sm text-blue-600 hover:text-blue-700",children:"忘记密码？"})}),(0,r.jsx)("div",{className:"mt-6 pt-6 border-t border-slate-200 text-center",children:(0,r.jsxs)("p",{className:"text-sm text-slate-600",children:["还没有账号？"," ",(0,r.jsx)("a",{href:"#",className:"text-blue-600 hover:text-blue-700 font-medium",children:"注册"})]})})]})}),(0,r.jsxs)("div",{className:"mt-12 text-center text-sm text-slate-500",children:[(0,r.jsx)("p",{children:"\xa9 2024 MemoVault. All rights reserved."}),(0,r.jsxs)("p",{className:"mt-2",children:[(0,r.jsx)("a",{href:"#",className:"hover:text-slate-700",children:"隐私政策"})," \xb7 ",(0,r.jsx)("a",{href:"#",className:"hover:text-slate-700",children:"服务条款"})," \xb7 ",(0,r.jsx)("a",{href:"#",className:"hover:text-slate-700",children:"开源代码"})]})]})]})})}function v(e){let{icon:t,title:s,description:a}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition-shadow",children:[(0,r.jsx)("div",{className:"flex items-center gap-3 mb-3 text-blue-600",children:t}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:s}),(0,r.jsx)("p",{className:"text-slate-600 text-sm",children:a})]})}}},function(e){e.O(0,[516,971,23,744],function(){return e(e.s=5536)}),_N_E=e.O()}]);